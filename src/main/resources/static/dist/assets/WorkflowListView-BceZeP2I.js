import{d as j,u as G,M as Z,x as B,b as C,c as $,o as w,w as y,e as o,m as b,_ as H,a as k,p as ee,B as h,r as oe,k as L,h as n,i as F,C as te,K as T,N as K,y as O,E as se,j as V,F as ae,z as ne,g as R}from"./index-CtjyYKdR.js";import{u as le,T as ie,A as re}from"./AgentConfigModal-BboUA2OL.js";import{s as J}from"./function-call-7Ysw4dEM.js";import{B as ue}from"./BaseAdminModal-R2kbZGTp.js";import{B as A,a as q,b as ce}from"./BaseTextarea-zArIqV57.js";import{u as P}from"./workflow-BYb1k4dZ.js";import"./auth-VAJY2tdE.js";import"./agent-DAkQHjpZ.js";import"./model-Bi4JVDDi.js";const de={class:"m-user-menu-header"},fe={class:"f-user-info"},me={class:"f-username"},pe={class:"f-email"},we=j({__name:"UserMenu",props:{show:{type:Boolean,default:!1}},emits:["update:show"],setup(U,{emit:u}){const f=U,c=u,m=G(),v=le(),W=Z(),s=B({get:()=>f.show,set:p=>c("update:show",p)}),r=B(()=>W.userInfo),a=B(()=>[{name:"ä¸ªäººä¿¡æ¯",icon:"user-o",callback:()=>m.push("/user/profile")},{name:"é€€å‡ºç™»å½•",icon:"sign",color:"#ee0a24",callback:d}]);function l(p){p.callback?.(p)}async function d(){try{await J({title:"ç¡®è®¤é€€å‡º",message:"ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ"}),await v.logout(),m.push("/auth/login")}catch{}}return(p,N)=>{const x=C("van-image"),M=C("van-icon"),S=C("van-action-sheet");return w(),$(S,{show:s.value,"onUpdate:show":N[0]||(N[0]=z=>s.value=z),actions:a.value,"cancel-text":"å–æ¶ˆ","close-on-click-action":"",onSelect:l},{description:y(()=>[o("div",de,[r.value?.avatarUrl?(w(),$(x,{key:0,src:r.value.avatarUrl,round:"",width:"60",height:"60",fit:"cover"},null,8,["src"])):(w(),$(M,{key:1,name:"user-circle-o",size:"60",color:"#999"})),o("div",fe,[o("div",me,b(r.value?.username||"ç”¨æˆ·"),1),o("div",pe,b(r.value?.email),1)])])]),_:1},8,["show","actions"])}}}),ve=H(we,[["__scopeId","data-v-3bafa7c1"]]);function ke(){const U=G(),u=P(),f=k(""),c=k("updateTime"),m=B(()=>{let a=u.workflows;if(f.value){const l=f.value.toLowerCase();a=a.filter(d=>d.workflowName.toLowerCase().includes(l)||d.description?.toLowerCase().includes(l))}return[...a].sort((l,d)=>{const p=new Date(l[c.value]).getTime();return new Date(d[c.value]).getTime()-p})});async function v(a){try{const l=await u.createNewWorkflow(a);h({type:"success",message:"åˆ›å»ºæˆåŠŸ"}),U.push(`/workflow/${l.id}`)}catch{h({type:"fail",message:"åˆ›å»ºå¤±è´¥ï¼Œè¯·é‡è¯•"})}}async function W(a,l){try{await J({title:"ç¡®è®¤åˆ é™¤",message:`ç¡®å®šè¦åˆ é™¤å·¥ä½œæµ"${l}"å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`}),await u.removeWorkflow(a),h({type:"success",message:"åˆ é™¤æˆåŠŸ"})}catch{}}function s(a){U.push(`/workflow/${a}`)}async function r(){try{await u.fetchWorkflows()}catch{h({type:"fail",message:"åŠ è½½å·¥ä½œæµåˆ—è¡¨å¤±è´¥"})}}return ee(()=>{r()}),{searchKeyword:f,sortBy:c,filteredWorkflows:m,isLoading:u.isLoading,hasWorkflows:u.hasWorkflows,createWorkflow:v,deleteWorkflow:W,openWorkflow:s,loadWorkflows:r}}const he={class:"g-workflow-list-view"},_e={class:"m-main-container"},ge={class:"m-toolbar"},ye={class:"f-toolbar-left"},be={class:"f-search-box"},Ce={class:"f-toolbar-right"},Ue={key:2,class:"m-workflows-grid"},We=["onClick"],Ne={class:"f-workflow-content"},Te={class:"f-workflow-header"},Ve={class:"f-workflow-title"},Be={class:"f-workflow-service"},$e={class:"f-workflow-description"},xe={class:"f-workflow-footer"},Le={class:"f-workflow-time"},Me={class:"f-workflow-actions"},Se=["onClick"],ze=["onClick"],De=j({__name:"WorkflowListView",setup(U){const u=k(!1),f=k(!1),c=k(!1),m=k(null),v=k("all"),W=P(),s=oe({workflowName:"",description:"",thumbnailUrl:""}),{searchKeyword:r,sortBy:a,filteredWorkflows:l,isLoading:d,deleteWorkflow:p,openWorkflow:N}=ke(),x=B(()=>l.value);function M(i){const e=new Date(i),D=new Date().getTime()-e.getTime(),g=Math.floor(D/(1e3*60*60*24));return g===0?"ä»Šå¤©":g===1?"æ˜¨å¤©":g<7?`${g}å¤©å‰`:e.toLocaleDateString("zh-CN")}function S(i){N(i.id)}function z(i){m.value=i,s.workflowName=i.workflowName,s.description=i.description||"",s.thumbnailUrl=i.thumbnailUrl||"",c.value=!0}function Q(i){p(i.id,i.workflowName)}async function X(){if(!s.workflowName.trim()){h({type:"fail",message:"è¯·è¾“å…¥å·¥ä½œæµåç§°"});return}if(m.value)try{await W.updateWorkflowInfo(m.value.id,{workflowName:s.workflowName,description:s.description||void 0,thumbnailUrl:s.thumbnailUrl||void 0}),h({type:"success",message:"æ›´æ–°æˆåŠŸ"}),E(),c.value=!1}catch{h({type:"fail",message:"æ›´æ–°å¤±è´¥"})}}function Y(){E()}function E(){s.workflowName="",s.description="",s.thumbnailUrl="",m.value=null}return(i,e)=>{const _=C("van-icon"),D=C("van-loading"),g=C("van-empty");return w(),L("div",he,[n(ie,{onOpenAgentConfig:e[0]||(e[0]=t=>f.value=!0)}),n(re,{visible:f.value,"onUpdate:visible":e[1]||(e[1]=t=>f.value=t)},null,8,["visible"]),n(ve,{show:u.value,"onUpdate:show":e[2]||(e[2]=t=>u.value=t)},null,8,["show"]),o("div",_e,[e[16]||(e[16]=o("div",{class:"m-page-header"},[o("h1",{class:"f-page-title"},"ðŸ“ æˆ‘çš„å·¥ä½œæµ"),o("p",{class:"f-page-subtitle"},"ç®¡ç†å’Œç¼–è¾‘ä½ çš„ ComfyUI å·¥ä½œæµ")],-1)),o("div",ge,[o("div",ye,[o("div",be,[n(_,{name:"search",size:"14"}),F(o("input",{"onUpdate:modelValue":e[3]||(e[3]=t=>K(r)?r.value=t:null),type:"text",placeholder:"æœç´¢å·¥ä½œæµ..."},null,512),[[te,T(r)]])]),o("button",{class:O(["f-filter-btn",{active:v.value==="all"}]),onClick:e[4]||(e[4]=t=>v.value="all")}," å…¨éƒ¨ ",2),o("button",{class:O(["f-filter-btn",{active:v.value==="favorite"}]),onClick:e[5]||(e[5]=t=>v.value="favorite")}," â­ æ”¶è— ",2)]),o("div",Ce,[F(o("select",{"onUpdate:modelValue":e[6]||(e[6]=t=>K(a)?a.value=t:null),class:"f-sort-select"},[...e[11]||(e[11]=[o("option",{value:"updateTime"},"æœ€è¿‘ä½¿ç”¨",-1),o("option",{value:"workflowName"},"åç§°",-1),o("option",{value:"createTime"},"åˆ›å»ºæ—¶é—´",-1)])],512),[[se,T(a)]])])]),T(d)?(w(),$(D,{key:0,class:"f-loading",type:"spinner",color:"#4a9eff",size:"40"},{default:y(()=>[...e[12]||(e[12]=[V(" åŠ è½½ä¸­... ",-1)])]),_:1})):!T(d)&&x.value.length===0?(w(),$(g,{key:1,image:"search",description:T(r)?"æœªæ‰¾åˆ°ç›¸å…³å·¥ä½œæµ":"æš‚æ— å·¥ä½œæµ"},null,8,["description"])):(w(),L("div",Ue,[(w(!0),L(ae,null,ne(x.value,t=>(w(),L("div",{key:t.id,class:"f-workflow-card",onClick:I=>S(t)},[e[15]||(e[15]=o("div",{class:"f-workflow-thumbnail"},[o("span",{class:"f-thumbnail-icon"},"ðŸ“Š")],-1)),o("div",Ne,[o("div",Te,[o("div",null,[o("h3",Ve,b(t.workflowName),1),o("div",Be,[n(_,{name:"cluster-o",size:"10"}),V(" "+b(t.comfyuiServerKey),1)])])]),o("p",$e,b(t.description||"æš‚æ— æè¿°"),1),o("div",xe,[o("div",Le,[n(_,{name:"clock-o",size:"10"}),V(" "+b(M(t.updateTime)),1)]),o("div",Me,[o("button",{class:"f-action-btn",onClick:R(I=>z(t),["stop"])},[n(_,{name:"edit",size:"12"}),e[13]||(e[13]=V(" ç¼–è¾‘ ",-1))],8,Se),o("button",{class:"f-action-btn",onClick:R(I=>Q(t),["stop"])},[n(_,{name:"delete-o",size:"12"}),e[14]||(e[14]=V(" åˆ é™¤ ",-1))],8,ze)])])])],8,We))),128))]))]),n(ue,{modelValue:c.value,"onUpdate:modelValue":e[10]||(e[10]=t=>c.value=t),title:"ç¼–è¾‘å·¥ä½œæµä¿¡æ¯",onConfirm:X,onCancel:Y},{default:y(()=>[n(A,{label:"å·¥ä½œæµåç§°",required:""},{default:y(()=>[n(q,{modelValue:s.workflowName,"onUpdate:modelValue":e[7]||(e[7]=t=>s.workflowName=t),placeholder:"è¯·è¾“å…¥å·¥ä½œæµåç§°",required:""},null,8,["modelValue"])]),_:1}),n(A,{label:"æè¿°"},{default:y(()=>[n(ce,{modelValue:s.description,"onUpdate:modelValue":e[8]||(e[8]=t=>s.description=t),placeholder:"è¯·è¾“å…¥å·¥ä½œæµæè¿°ï¼ˆå¯é€‰ï¼‰",rows:3},null,8,["modelValue"])]),_:1}),n(A,{label:"ç¼©ç•¥å›¾ URL"},{default:y(()=>[n(q,{modelValue:s.thumbnailUrl,"onUpdate:modelValue":e[9]||(e[9]=t=>s.thumbnailUrl=t),placeholder:"https://example.com/thumbnail.png"},null,8,["modelValue"])]),_:1})]),_:1},8,["modelValue"])])}}}),Ge=H(De,[["__scopeId","data-v-3638ef18"]]);export{Ge as default};
