import{d as x,u as C,n as N,r as g,a as w,p as R,b as q,c as z,o as t,w as l,e as a,k as p,f as I,g as S,h as r,j as f,_ as A}from"./index-CtjyYKdR.js";import{B as P,A as L}from"./BaseButton-CEgwoOAm.js";import{B as M}from"./BaseIcon-CFB3GQ0e.js";import{P as k}from"./PasswordInput-D525COQF.js";import{b as T}from"./validator-C8VLtmvt.js";import{a as U}from"./auth-VAJY2tdE.js";const j={class:"g-reset-password-view"},D={key:1,class:"g-reset-password-view__success"},E={key:2,class:"g-reset-password-view__footer"},$=x({__name:"ResetPasswordView",setup(F){const m=C(),V=N(),o=g({password:"",confirmPassword:""}),e=g({password:"",confirmPassword:""}),n=w(!1),i=w(!1),d=w("");R(()=>{d.value=V.query.token,d.value||m.push("/login")});function c(){o.password?T(o.password)?e.password="":e.password="密码至少8位，包含字母和数字":e.password="请输入新密码"}function v(){o.confirmPassword?o.confirmPassword!==o.password?e.confirmPassword="两次输入的密码不一致":e.confirmPassword="":e.confirmPassword="请再次输入新密码"}async function y(){if(c(),v(),!(e.password||e.confirmPassword)){n.value=!0;try{await U({token:d.value,newPassword:o.password}),i.value=!0}catch(_){console.error("重置密码失败:",_),e.password="重置链接已失效，请重新申请"}finally{n.value=!1}}}function B(){m.push("/login")}return(_,s)=>{const b=q("router-link");return t(),z(L,null,{default:l(()=>[a("div",j,[s[7]||(s[7]=a("h2",{class:"g-reset-password-view__title"},"重置密码",-1)),s[8]||(s[8]=a("p",{class:"g-reset-password-view__description"},"请输入您的新密码",-1)),i.value?(t(),p("div",D,[r(M,{name:"check-circle",size:48,color:"#52c41a"}),s[4]||(s[4]=a("p",{class:"g-reset-password-view__success-text"},"密码重置成功",-1)),s[5]||(s[5]=a("p",{class:"g-reset-password-view__success-hint"},"请使用新密码登录",-1)),r(P,{variant:"primary",size:"large",block:"",onClick:B},{default:l(()=>[...s[3]||(s[3]=[f(" 前往登录 ",-1)])]),_:1})])):(t(),p("form",{key:0,class:"g-reset-password-view__form",onSubmit:S(y,["prevent"])},[r(k,{modelValue:o.password,"onUpdate:modelValue":s[0]||(s[0]=u=>o.password=u),label:"新密码",placeholder:"至少8位，包含字母和数字",required:"",error:e.password,onBlur:c},null,8,["modelValue","error"]),r(k,{modelValue:o.confirmPassword,"onUpdate:modelValue":s[1]||(s[1]=u=>o.confirmPassword=u),label:"确认新密码",placeholder:"请再次输入新密码",required:"",error:e.confirmPassword,onBlur:v},null,8,["modelValue","error"]),r(P,{type:"submit",variant:"primary",size:"large",block:"",loading:n.value},{default:l(()=>[...s[2]||(s[2]=[f(" 重置密码 ",-1)])]),_:1},8,["loading"])],32)),i.value?I("",!0):(t(),p("div",E,[r(b,{to:"/login",class:"g-reset-password-view__link"},{default:l(()=>[...s[6]||(s[6]=[f(" 返回登录 ",-1)])]),_:1})]))])]),_:1})}}}),W=A($,[["__scopeId","data-v-a68adefb"]]);export{W as default};
