import{d as S,a as i,b as O,c as R,o as p,w as Z,e as s,m as a,k as h,_ as U,u as j,M as q,r as k,x as M,D as J,h as P,f as $,i as B,C as K,G as A,g as Q,B as l}from"./index-CtjyYKdR.js";import{u as X,T as Y,A as ss}from"./AgentConfigModal-BboUA2OL.js";import"./auth-VAJY2tdE.js";import"./agent-DAkQHjpZ.js";import"./model-Bi4JVDDi.js";const es={class:"m-delete-account-modal"},ts={class:"f-modal-title"},os={class:"f-modal-body"},ls={key:0,class:"f-message"},as={key:1,class:"f-message"},ns={class:"f-warning"},is={class:"f-modal-footer"},rs=["disabled"],ds=S({__name:"DeleteAccountModal",props:{visible:{type:Boolean},step:{}},emits:["update:visible","confirm"],setup(w,{emit:x}){const n=x,y=i(!1);function b(){n("confirm")}function r(){n("update:visible",!1)}return(_,c)=>{const f=O("van-popup");return p(),R(f,{show:w.visible,position:"center",style:{width:"90%",maxWidth:"480px"},round:"",closeable:"",onClose:r,"onUpdate:show":c[0]||(c[0]=u=>n("update:visible",u))},{default:Z(()=>[s("div",es,[s("h3",ts,[s("span",null,a(w.step===1?"⚠️ 危险操作":"⚠️ 最后确认"),1)]),s("div",os,[w.step===1?(p(),h("p",ls," 删除账号后，所有工作流、会话和数据将被永久删除，且无法恢复。 ")):(p(),h("p",as," 真的要删除账号吗？此操作不可逆！ ")),s("p",ns,a(w.step===1?"确定要删除账号吗？":"这是最后一次确认机会！"),1)]),s("div",is,[s("button",{class:"f-btn",onClick:r},"取消"),s("button",{class:"f-btn f-btn-danger",onClick:b,disabled:y.value},a(y.value?"删除中...":"确认删除"),9,rs)])])]),_:1},8,["show"])}}}),cs=U(ds,[["__scopeId","data-v-5a92e72a"]]),fs={class:"g-user-profile-view"},us={class:"m-main-container"},vs={class:"m-profile-header"},ms={class:"f-avatar-section"},ps={class:"f-avatar-large"},ws={class:"f-profile-info"},bs={class:"f-profile-name"},gs={class:"f-profile-email"},hs={class:"f-profile-stats"},ys={class:"f-stat-item"},_s={class:"f-stat-value"},Cs={class:"f-stat-item"},zs={class:"f-stat-value"},Ms={class:"f-stat-item"},xs={class:"f-stat-value"},Vs={class:"f-stat-item"},ks={class:"f-stat-value"},Ps={class:"m-profile-section"},Bs={class:"f-form-group"},Ds=["value"],Hs={class:"f-form-row"},$s={class:"f-form-group"},As={class:"f-form-group"},Ss=["value"],Us={class:"f-form-row"},Ts={class:"f-form-group"},Ls=["value"],Ns={class:"f-form-group"},Is=["value"],Ws={class:"f-form-actions"},Es=["disabled"],Fs={class:"f-modal-header"},Gs={class:"f-modal-logo"},Os={class:"f-icon f-icon-xl",viewBox:"0 0 24 24",fill:"currentColor",style:{color:"#4a9eff"}},Rs={class:"f-modal-body"},Zs={class:"f-form-group"},js={class:"f-password-input-wrapper"},qs=["type"],Js={class:"f-form-group"},Ks={class:"f-password-input-wrapper"},Qs=["type"],Xs=["disabled"],Ys=S({__name:"UserProfileView",setup(w){const x=j(),n=q(),y=X(),b=i(!1),r=i(!1),_=i(1),c=i(!1),f=i(!1),u=i(!1),C=i(!1),z=i(!1),v=k({username:""}),d=k({newPassword:"",confirmPassword:""}),g=k({totalWorkflows:0,activeSessions:0,workflowVersions:0,usageDays:0}),m=M(()=>n.userInfo),T=M(()=>n.username||"用户"),D=M(()=>n.email||"user@example.com"),L=M(()=>(n.username||"U").charAt(0).toUpperCase());J(m,t=>{if(t&&(v.username=t.username||"",t.createTime)){const e=new Date(t.createTime),G=Math.abs(new Date().getTime()-e.getTime());g.usageDays=Math.ceil(G/(1e3*60*60*24))}},{immediate:!0});function H(t){if(!t)return"-";try{return new Date(t).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return"-"}}function N(){m.value&&(v.username=m.value.username||""),l({type:"success",message:"表单已重置"})}async function I(){if(!v.username.trim()){l({type:"fail",message:"用户名不能为空"});return}try{C.value=!0,await n.updateUserInfo({username:v.username}),l({type:"success",message:"个人信息已保存"})}catch{l({type:"fail",message:"保存失败，请重试"})}finally{C.value=!1}}function W(){c.value=!0,d.newPassword="",d.confirmPassword="",f.value=!1,u.value=!1}function V(){c.value=!1}async function E(){const{newPassword:t,confirmPassword:e}=d;if(!t||!e){l({type:"fail",message:"请填写完整的密码信息"});return}if(t.length<8){l({type:"fail",message:"密码长度至少为8个字符"});return}if(!/^(?=.*[A-Za-z])(?=.*\d).+$/.test(t)){l({type:"fail",message:"密码必须包含字母和数字"});return}if(t!==e){l({type:"fail",message:"两次输入的密码不一致"});return}try{z.value=!0,l({type:"success",message:"密码更新成功"}),V()}catch{l({type:"fail",message:"密码更新失败，请重试"})}finally{z.value=!1}}async function F(){if(_.value===1)_.value=2;else try{l({type:"success",message:"账号已删除"}),r.value=!1,await y.logout(),x.push("/login")}catch{l({type:"fail",message:"删除账号失败，请重试"}),r.value=!1}}return(t,e)=>(p(),h("div",fs,[P(Y,{onOpenAgentConfig:e[0]||(e[0]=o=>b.value=!0)}),P(ss,{visible:b.value,"onUpdate:visible":e[1]||(e[1]=o=>b.value=o)},null,8,["visible"]),P(cs,{visible:r.value,"onUpdate:visible":e[2]||(e[2]=o=>r.value=o),step:_.value,onConfirm:F},null,8,["visible","step"]),s("div",us,[s("div",vs,[s("div",ms,[s("div",ps,a(L.value),1),e[9]||(e[9]=s("button",{class:"f-change-avatar-btn"},[s("svg",{class:"f-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[s("path",{d:"M12 15.2c1.77 0 3.2-1.43 3.2-3.2s-1.43-3.2-3.2-3.2-3.2 1.43-3.2 3.2 1.43 3.2 3.2 3.2zm0-5.4c1.21 0 2.2.99 2.2 2.2s-.99 2.2-2.2 2.2-2.2-.99-2.2-2.2.99-2.2 2.2-2.2z"}),s("path",{d:"M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm11 14H4V6h4.05l1.83-2h4.24l1.83 2H20v10z"})]),s("span",null,"更换头像")],-1))]),s("div",ws,[s("h1",bs,a(T.value),1),s("div",gs,[e[10]||(e[10]=s("svg",{class:"f-icon",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"})],-1)),s("span",null,a(D.value),1)]),s("div",hs,[s("div",ys,[s("div",_s,a(g.totalWorkflows),1),e[11]||(e[11]=s("div",{class:"f-stat-label"},"工作流总数",-1))]),s("div",Cs,[s("div",zs,a(g.activeSessions),1),e[12]||(e[12]=s("div",{class:"f-stat-label"},"活跃会话",-1))]),s("div",Ms,[s("div",xs,a(g.workflowVersions),1),e[13]||(e[13]=s("div",{class:"f-stat-label"},"工作流版本",-1))]),s("div",Vs,[s("div",ks,a(g.usageDays),1),e[14]||(e[14]=s("div",{class:"f-stat-label"},"使用天数",-1))])])])]),s("div",Ps,[e[22]||(e[22]=s("div",{class:"f-section-header"},[s("h2",{class:"f-section-title"},[s("svg",{class:"f-icon f-icon-lg",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})]),s("span",null,"基本信息")])],-1)),s("div",Bs,[e[15]||(e[15]=s("label",{class:"f-form-label"},"用户编码",-1)),s("input",{type:"text",class:"f-form-input",value:m.value?.id,disabled:""},null,8,Ds)]),s("div",Hs,[s("div",$s,[e[16]||(e[16]=s("label",{class:"f-form-label"},"显示名称",-1)),B(s("input",{type:"text",class:"f-form-input","onUpdate:modelValue":e[3]||(e[3]=o=>v.username=o),placeholder:"请输入显示名称"},null,512),[[K,v.username]])]),s("div",As,[e[17]||(e[17]=s("label",{class:"f-form-label"},"邮箱地址",-1)),s("input",{type:"email",class:"f-form-input",value:D.value,disabled:""},null,8,Ss)])]),s("div",Us,[s("div",Ts,[e[18]||(e[18]=s("label",{class:"f-form-label"},"注册时间",-1)),s("input",{type:"text",class:"f-form-input",value:H(m.value?.createTime),disabled:""},null,8,Ls)]),s("div",Ns,[e[19]||(e[19]=s("label",{class:"f-form-label"},"最后登录",-1)),s("input",{type:"text",class:"f-form-input",value:H(m.value?.lastLoginTime),disabled:""},null,8,Is)])]),s("div",Ws,[s("button",{class:"f-btn f-btn-secondary",onClick:N},[...e[20]||(e[20]=[s("svg",{class:"f-icon",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})],-1),s("span",null,"重置",-1)])]),s("button",{class:"f-btn f-btn-primary",onClick:I,disabled:C.value},[e[21]||(e[21]=s("svg",{class:"f-icon",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"})],-1)),s("span",null,a(C.value?"保存中...":"保存修改"),1)],8,Es)])]),s("div",{class:"m-profile-section"},[e[26]||(e[26]=s("div",{class:"f-section-header"},[s("h2",{class:"f-section-title"},[s("svg",{class:"f-icon f-icon-lg",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"})]),s("span",null,"账号安全")])],-1)),s("div",{class:"f-form-group"},[e[25]||(e[25]=s("label",{class:"f-form-label"},"登录方式",-1)),s("div",{class:"f-security-row"},[e[24]||(e[24]=s("div",{class:"f-security-info"},[s("svg",{class:"f-icon",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"})]),s("span",null,"密码登录")],-1)),s("button",{class:"f-btn f-btn-secondary",onClick:W},[...e[23]||(e[23]=[s("svg",{class:"f-icon",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"})],-1),s("span",null,"更新密码",-1)])])])])]),$("",!0)]),c.value?(p(),h("div",{key:0,class:"m-modal-overlay",onClick:V},[s("div",{class:"m-password-modal",onClick:e[8]||(e[8]=Q(()=>{},["stop"]))},[s("div",Fs,[s("div",Gs,[(p(),h("svg",Os,[...e[31]||(e[31]=[s("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"},null,-1)])]))]),s("button",{class:"f-modal-close",onClick:V},[...e[32]||(e[32]=[s("span",null,"×",-1)])])]),s("div",Rs,[e[37]||(e[37]=s("h3",{class:"f-modal-title"},"修改密码",-1)),s("div",Zs,[e[34]||(e[34]=s("label",{class:"f-form-label"},"输入新密码",-1)),s("div",js,[B(s("input",{type:f.value?"text":"password",class:"f-form-input","onUpdate:modelValue":e[4]||(e[4]=o=>d.newPassword=o),placeholder:"输入新密码"},null,8,qs),[[A,d.newPassword]]),s("button",{type:"button",class:"f-password-toggle-btn",onClick:e[5]||(e[5]=o=>f.value=!f.value)},[...e[33]||(e[33]=[s("svg",{class:"f-icon",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"})],-1)])])])]),s("div",Js,[e[36]||(e[36]=s("label",{class:"f-form-label"},"确认密码",-1)),s("div",Ks,[B(s("input",{type:u.value?"text":"password",class:"f-form-input","onUpdate:modelValue":e[6]||(e[6]=o=>d.confirmPassword=o),placeholder:"再次输入相同的密码"},null,8,Qs),[[A,d.confirmPassword]]),s("button",{type:"button",class:"f-password-toggle-btn",onClick:e[7]||(e[7]=o=>u.value=!u.value)},[...e[35]||(e[35]=[s("svg",{class:"f-icon",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"})],-1)])])])]),s("button",{class:"f-btn f-btn-primary f-btn-full",onClick:E,disabled:z.value},a(z.value?"更新中...":"更新密码"),9,Xs)])])])):$("",!0)]))}}),ae=U(Ys,[["__scopeId","data-v-ae63594c"]]);export{ae as default};
