import{d as $,M as E,a as f,r as y,x as w,D as F,k as C,o as z,g as B,e as s,l as I,m as a,h as x,C as W,G as _,f as G,B as l,_ as O}from"./index-DUI3biLs.js";import{u as Z,T as j,A as q}from"./AgentConfigModal-ByHDG3aW.js";import{s as P}from"./function-call-1j34QfgJ.js";import"./auth-DHo3H-uo.js";import"./agent-ChawvV1-.js";import"./model-JByLflBC.js";const J={class:"g-user-profile-view"},K={class:"m-main-container"},Q={class:"m-profile-header"},R={class:"f-avatar-section"},X={class:"f-avatar-large"},Y={class:"f-profile-info"},ss={class:"f-profile-name"},ts={class:"f-profile-email"},os={class:"f-profile-stats"},es={class:"f-stat-item"},ls={class:"f-stat-value"},as={class:"f-stat-item"},ns={class:"f-stat-value"},is={class:"f-stat-item"},rs={class:"f-stat-value"},fs={class:"f-stat-item"},ds={class:"f-stat-value"},cs={class:"m-profile-section"},us={class:"f-form-group"},vs=["value"],ms={class:"f-form-row"},ps={class:"f-form-group"},ws={class:"f-form-group"},gs=["value"],bs={class:"f-form-row"},hs={class:"f-form-group"},ys=["value"],Cs={class:"f-form-group"},zs=["value"],xs={class:"f-form-actions"},Ms=["disabled"],Vs={class:"f-modal-header"},Bs={class:"f-modal-logo"},_s={class:"f-icon f-icon-xl",viewBox:"0 0 24 24",fill:"currentColor",style:{color:"#4a9eff"}},Ps={class:"f-modal-body"},ks={class:"f-form-group"},Ds={class:"f-password-input-wrapper"},Hs=["type"],Ts={class:"f-form-group"},Ss={class:"f-password-input-wrapper"},Us=["type"],Ls=["disabled"],As=$({__name:"UserProfileView",setup(Ns){const d=E(),k=Z(),g=f(!1),b=f(!1),u=f(!1),v=f(!1),m=f(!1),p=f(!1),i=y({username:""}),n=y({newPassword:"",confirmPassword:""}),c=y({totalWorkflows:0,activeSessions:0,workflowVersions:0,usageDays:0}),r=w(()=>d.userInfo),D=w(()=>d.username||"用户"),M=w(()=>d.email||"user@example.com"),H=w(()=>(d.username||"U").charAt(0).toUpperCase());F(r,o=>{if(o&&(i.username=o.username||"",o.createTime)){const t=new Date(o.createTime),N=Math.abs(new Date().getTime()-t.getTime());c.usageDays=Math.ceil(N/(1e3*60*60*24))}},{immediate:!0});function V(o){if(!o)return"-";try{return new Date(o).toLocaleDateString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit"})}catch{return"-"}}function T(){r.value&&(i.username=r.value.username||""),l({type:"success",message:"表单已重置"})}async function S(){if(!i.username.trim()){l({type:"fail",message:"用户名不能为空"});return}try{m.value=!0,await d.updateUserInfo({username:i.username}),l({type:"success",message:"个人信息已保存"})}catch{l({type:"fail",message:"保存失败，请重试"})}finally{m.value=!1}}function U(){b.value=!0,n.newPassword="",n.confirmPassword="",u.value=!1,v.value=!1}function h(){b.value=!1}async function L(){const{newPassword:o,confirmPassword:t}=n;if(!o||!t){l({type:"fail",message:"请填写完整的密码信息"});return}if(o.length<8){l({type:"fail",message:"密码长度至少为8个字符"});return}if(!/^(?=.*[A-Za-z])(?=.*\d).+$/.test(o)){l({type:"fail",message:"密码必须包含字母和数字"});return}if(o!==t){l({type:"fail",message:"两次输入的密码不一致"});return}try{p.value=!0,l({type:"success",message:"密码更新成功"}),h()}catch{l({type:"fail",message:"密码更新失败，请重试"})}finally{p.value=!1}}async function A(){try{await P({title:"⚠️ 危险操作",message:`删除账号后，所有工作流、会话和数据将被永久删除，且无法恢复。

确定要删除账号吗？`,confirmButtonText:"确认删除",cancelButtonText:"取消",confirmButtonColor:"#e74c3c"}),await P({title:"⚠️ 最后确认",message:"真的要删除账号吗？此操作不可逆！",confirmButtonText:"确认删除",cancelButtonText:"取消",confirmButtonColor:"#e74c3c"}),l({type:"success",message:"账号已删除"}),await k.logout()}catch{}}return(o,t)=>(z(),C("div",J,[B(j,{onOpenAgentConfig:t[0]||(t[0]=e=>g.value=!0)}),B(q,{visible:g.value,"onUpdate:visible":t[1]||(t[1]=e=>g.value=e)},null,8,["visible"]),s("div",K,[s("div",Q,[s("div",R,[s("div",X,a(H.value),1),t[8]||(t[8]=s("button",{class:"f-change-avatar-btn"},[s("svg",{class:"f-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[s("path",{d:"M12 15.2c1.77 0 3.2-1.43 3.2-3.2s-1.43-3.2-3.2-3.2-3.2 1.43-3.2 3.2 1.43 3.2 3.2 3.2zm0-5.4c1.21 0 2.2.99 2.2 2.2s-.99 2.2-2.2 2.2-2.2-.99-2.2-2.2.99-2.2 2.2-2.2z"}),s("path",{d:"M9 2L7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm11 14H4V6h4.05l1.83-2h4.24l1.83 2H20v10z"})]),s("span",null,"更换头像")],-1))]),s("div",Y,[s("h1",ss,a(D.value),1),s("div",ts,[t[9]||(t[9]=s("svg",{class:"f-icon",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 4l-8 5-8-5V6l8 5 8-5v2z"})],-1)),s("span",null,a(M.value),1)]),s("div",os,[s("div",es,[s("div",ls,a(c.totalWorkflows),1),t[10]||(t[10]=s("div",{class:"f-stat-label"},"工作流总数",-1))]),s("div",as,[s("div",ns,a(c.activeSessions),1),t[11]||(t[11]=s("div",{class:"f-stat-label"},"活跃会话",-1))]),s("div",is,[s("div",rs,a(c.workflowVersions),1),t[12]||(t[12]=s("div",{class:"f-stat-label"},"工作流版本",-1))]),s("div",fs,[s("div",ds,a(c.usageDays),1),t[13]||(t[13]=s("div",{class:"f-stat-label"},"使用天数",-1))])])])]),s("div",cs,[t[21]||(t[21]=s("div",{class:"f-section-header"},[s("h2",{class:"f-section-title"},[s("svg",{class:"f-icon f-icon-lg",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})]),s("span",null,"基本信息")])],-1)),s("div",us,[t[14]||(t[14]=s("label",{class:"f-form-label"},"用户编码",-1)),s("input",{type:"text",class:"f-form-input",value:r.value?.id,disabled:""},null,8,vs)]),s("div",ms,[s("div",ps,[t[15]||(t[15]=s("label",{class:"f-form-label"},"显示名称",-1)),x(s("input",{type:"text",class:"f-form-input","onUpdate:modelValue":t[2]||(t[2]=e=>i.username=e),placeholder:"请输入显示名称"},null,512),[[W,i.username]])]),s("div",ws,[t[16]||(t[16]=s("label",{class:"f-form-label"},"邮箱地址",-1)),s("input",{type:"email",class:"f-form-input",value:M.value,disabled:""},null,8,gs)])]),s("div",bs,[s("div",hs,[t[17]||(t[17]=s("label",{class:"f-form-label"},"注册时间",-1)),s("input",{type:"text",class:"f-form-input",value:V(r.value?.createTime),disabled:""},null,8,ys)]),s("div",Cs,[t[18]||(t[18]=s("label",{class:"f-form-label"},"最后登录",-1)),s("input",{type:"text",class:"f-form-input",value:V(r.value?.lastLoginTime),disabled:""},null,8,zs)])]),s("div",xs,[s("button",{class:"f-btn f-btn-secondary",onClick:T},[...t[19]||(t[19]=[s("svg",{class:"f-icon",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"})],-1),s("span",null,"重置",-1)])]),s("button",{class:"f-btn f-btn-primary",onClick:S,disabled:m.value},[t[20]||(t[20]=s("svg",{class:"f-icon",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"})],-1)),s("span",null,a(m.value?"保存中...":"保存修改"),1)],8,Ms)])]),s("div",{class:"m-profile-section"},[t[25]||(t[25]=s("div",{class:"f-section-header"},[s("h2",{class:"f-section-title"},[s("svg",{class:"f-icon f-icon-lg",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"})]),s("span",null,"账号安全")])],-1)),s("div",{class:"f-form-group"},[t[24]||(t[24]=s("label",{class:"f-form-label"},"登录方式",-1)),s("div",{class:"f-security-row"},[t[23]||(t[23]=s("div",{class:"f-security-info"},[s("svg",{class:"f-icon",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"})]),s("span",null,"密码登录")],-1)),s("button",{class:"f-btn f-btn-secondary",onClick:U},[...t[22]||(t[22]=[s("svg",{class:"f-icon",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"})],-1),s("span",null,"更新密码",-1)])])])])]),s("div",{class:"m-profile-section"},[t[29]||(t[29]=s("div",{class:"f-section-header"},[s("h2",{class:"f-section-title"},[s("svg",{class:"f-icon f-icon-lg",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"})]),s("span",null,"危险操作")])],-1)),s("div",{class:"f-form-group"},[t[27]||(t[27]=s("label",{class:"f-form-label"},"删除账号",-1)),t[28]||(t[28]=s("div",{class:"f-danger-warning"}," 删除账号后，所有工作流、会话和数据将被永久删除，且无法恢复。 ",-1)),s("button",{class:"f-btn f-btn-danger",onClick:A},[...t[26]||(t[26]=[s("svg",{class:"f-icon",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6v12zM19 4h-3.5l-1-1h-5l-1 1H5v2h14V4z"})],-1),s("span",null,"删除我的账号",-1)])])])])]),b.value?(z(),C("div",{key:0,class:"m-modal-overlay",onClick:h},[s("div",{class:"m-password-modal",onClick:t[7]||(t[7]=G(()=>{},["stop"]))},[s("div",Vs,[s("div",Bs,[(z(),C("svg",_s,[...t[30]||(t[30]=[s("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"},null,-1)])]))]),s("button",{class:"f-modal-close",onClick:h},[...t[31]||(t[31]=[s("span",null,"×",-1)])])]),s("div",Ps,[t[36]||(t[36]=s("h3",{class:"f-modal-title"},"修改密码",-1)),s("div",ks,[t[33]||(t[33]=s("label",{class:"f-form-label"},"输入新密码",-1)),s("div",Ds,[x(s("input",{type:u.value?"text":"password",class:"f-form-input","onUpdate:modelValue":t[3]||(t[3]=e=>n.newPassword=e),placeholder:"输入新密码"},null,8,Hs),[[_,n.newPassword]]),s("button",{type:"button",class:"f-password-toggle-btn",onClick:t[4]||(t[4]=e=>u.value=!u.value)},[...t[32]||(t[32]=[s("svg",{class:"f-icon",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"})],-1)])])])]),s("div",Ts,[t[35]||(t[35]=s("label",{class:"f-form-label"},"确认密码",-1)),s("div",Ss,[x(s("input",{type:v.value?"text":"password",class:"f-form-input","onUpdate:modelValue":t[5]||(t[5]=e=>n.confirmPassword=e),placeholder:"再次输入相同的密码"},null,8,Us),[[_,n.confirmPassword]]),s("button",{type:"button",class:"f-password-toggle-btn",onClick:t[6]||(t[6]=e=>v.value=!v.value)},[...t[34]||(t[34]=[s("svg",{class:"f-icon",viewBox:"0 0 24 24",fill:"currentColor"},[s("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"})],-1)])])])]),s("button",{class:"f-btn f-btn-primary f-btn-full",onClick:L,disabled:p.value},a(p.value?"更新中...":"更新密码"),9,Ls)])])])):I("",!0)]))}}),Os=O(As,[["__scopeId","data-v-72c67c14"]]);export{Os as default};
