import{T as $,A as T}from"./AgentConfigModal-ByHDG3aW.js";import{d as b,x as m,k as u,o as d,y as N,l as g,e as s,q as S,m as v,_ as H,a as w,c as Y,w as k,f as L,g as y,i as M,K as _,B as h,u as U,p as A,F as B,z as D}from"./index-DUI3biLs.js";import{B as E}from"./BaseIcon-DumgPGM3.js";import{t as I}from"./service-C9zbT-OU.js";import{u as x}from"./service-C4JArz64.js";import"./auth-DHo3H-uo.js";import"./function-call-1j34QfgJ.js";import"./agent-ChawvV1-.js";import"./model-JByLflBC.js";const V={key:0,class:"f-base-card__header"},K={class:"f-base-card__title"},O={class:"f-base-card__body"},W={key:1,class:"f-base-card__footer"},z=b({__name:"BaseCard",props:{title:{},hoverable:{type:Boolean,default:!1},bordered:{type:Boolean,default:!0}},setup(a){const r=a,t=m(()=>["f-base-card",{"f-base-card--hoverable":r.hoverable,"f-base-card--bordered":r.bordered}]);return(o,l)=>(d(),u("div",{class:N(t.value)},[o.$slots.header||a.title?(d(),u("div",V,[S(o.$slots,"header",{},()=>[s("h3",K,v(a.title),1)])])):g("",!0),s("div",O,[S(o.$slots,"default",{},void 0)]),o.$slots.footer?(d(),u("div",W,[S(o.$slots,"footer",{},void 0)])):g("",!0)],2))}}),F=H(z,[["__scopeId","data-v-c79f6b28"]]);function R(a,r="YYYY-MM-DD HH:mm:ss"){const t=typeof a=="string"?new Date(a):a,o=t.getFullYear(),l=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0"),c=String(t.getHours()).padStart(2,"0"),e=String(t.getMinutes()).padStart(2,"0"),n=String(t.getSeconds()).padStart(2,"0");return r.replace("YYYY",String(o)).replace("MM",l).replace("DD",i).replace("HH",c).replace("mm",e).replace("ss",n)}function q(a){const r=typeof a=="string"?new Date(a):a,o=new Date().getTime()-r.getTime(),l=Math.floor(o/1e3),i=Math.floor(l/60),c=Math.floor(i/60),e=Math.floor(c/24);return l<60?"刚刚":i<60?`${i} 分钟前`:c<24?`${c} 小时前`:e<7?`${e} 天前`:R(r,"YYYY-MM-DD")}const f={HEALTHY:"HEALTHY",UNHEALTHY:"UNHEALTHY",UNKNOWN:"UNKNOWN"},j={class:"f-service-card__header"},G={class:"f-service-card__status-text"},J={class:"f-service-card__body"},P={class:"f-service-card__name"},Q={class:"f-service-card__url"},X=["disabled"],Z={key:0,class:"f-service-card__description"},ee={class:"f-service-card__footer"},se={class:"f-service-card__info"},te={class:"f-service-card__info-item"},ae=b({__name:"ServiceCard",props:{service:{}},emits:["select","update"],setup(a,{emit:r}){const t=a,o=r,l=m(()=>({"f-service-card__status--online":t.service.healthStatus===f.HEALTHY,"f-service-card__status--offline":t.service.healthStatus===f.UNKNOWN,"f-service-card__status--error":t.service.healthStatus===f.UNHEALTHY})),i=m(()=>{switch(t.service.healthStatus){case f.HEALTHY:return"健康";case f.UNHEALTHY:return"异常";case f.UNKNOWN:return"未知";default:return"未知"}}),c=w(!1);async function e(){c.value=!0;try{const p=await I(t.service.id);h({type:p.healthStatus===f.HEALTHY?"success":"fail",message:p.healthStatus===f.HEALTHY?"连接测试成功":"连接测试失败"}),o("update",p)}catch{h({type:"fail",message:"连接测试失败"})}finally{c.value=!1}}function n(){o("select",t.service)}return(p,C)=>(d(),Y(F,{hoverable:!0,class:"f-service-card",onClick:n},{default:k(()=>[s("div",j,[s("div",{class:N(["f-service-card__status",l.value])},[C[0]||(C[0]=s("span",{class:"f-service-card__status-dot"},null,-1)),s("span",G,v(i.value),1)],2)]),s("div",J,[s("h3",P,v(a.service.serverName),1),s("p",Q,v(a.service.baseUrl),1),s("button",{class:"f-service-card__test-btn",disabled:c.value,onClick:L(e,["stop"])},v(c.value?"测试中...":"测试连接"),9,X),a.service.description?(d(),u("p",Z,v(a.service.description),1)):g("",!0)]),s("div",ee,[s("div",se,[s("span",te,[y(E,{name:"clock",size:14}),M(" "+v(_(q)(a.service.updateTime)),1)])])])]),_:1}))}}),re=H(ae,[["__scopeId","data-v-147c0910"]]);function oe(){const a=U(),r=x(),t=w(""),o=m(()=>{if(!t.value)return r.enabledServices;const e=t.value.toLowerCase();return r.enabledServices.filter(n=>n.serverName.toLowerCase().includes(e)||n.description?.toLowerCase().includes(e))});function l(e){r.selectService(e.id),h({type:"success",message:`已选择 ${e.serverName}`}),a.push(`/comfy/workflows/${e.id}`)}function i(e){r.updateServiceInList(e)}async function c(){try{await r.fetchEnabledServices()}catch{h({type:"fail",message:"加载服务列表失败"})}}return A(()=>{c(),r.restoreSelectedService()}),{searchKeyword:t,filteredServices:o,isLoading:m(()=>r.isLoading),selectService:l,updateService:i,loadServices:c}}const ce={class:"g-service-selection-view"},ie={class:"m-main-container"},ne={class:"m-services-container"},le={key:0,class:"f-loading-state"},de={key:1,class:"f-empty-state"},ue={key:2,class:"f-services-grid"},fe=b({__name:"ServiceSelectionView",setup(a){const{filteredServices:r,isLoading:t,selectService:o,updateService:l}=oe(),i=w(!1);return(c,e)=>(d(),u("div",ce,[y($,{onOpenAgentConfig:e[0]||(e[0]=n=>i.value=!0)}),y(T,{visible:i.value,"onUpdate:visible":e[1]||(e[1]=n=>i.value=n)},null,8,["visible"]),s("div",ie,[e[4]||(e[4]=s("div",{class:"m-header-section"},[s("h1",null,"选择 ComfyUI 服务"),s("p",null,"选择一个可用的 ComfyUI 服务来开始创建工作流")],-1)),s("div",ne,[_(t)?(d(),u("div",le,[...e[2]||(e[2]=[s("div",{class:"f-spinner"},null,-1),s("p",null,"加载服务列表中...",-1)])])):_(r).length===0?(d(),u("div",de,[...e[3]||(e[3]=[s("svg",{class:"f-empty-icon",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor"},[s("circle",{cx:"11",cy:"11",r:"8"}),s("path",{d:"m21 21-4.35-4.35"})],-1),s("p",null,"暂无可用服务",-1),s("span",null,"请联系管理员添加 ComfyUI 服务",-1)])])):(d(),u("div",ue,[(d(!0),u(B,null,D(_(r),n=>(d(),Y(re,{key:n.id,service:n,onSelect:_(o),onUpdate:_(l)},null,8,["service","onSelect","onUpdate"]))),128))]))])])]))}}),He=H(fe,[["__scopeId","data-v-446ab880"]]);export{He as default};
