<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æµ‹è¯• 4: ç»¼åˆé›†æˆæµ‹è¯•</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    height: 100vh;
    display: flex;
    background: #1e1e1e;
    overflow: hidden;
}

.sidebar {
    width: 300px;
    background: #2c3e50;
    color: white;
    display: flex;
    flex-direction: column;
    border-right: 1px solid #34495e;
}

.sidebar-header {
    padding: 20px;
    border-bottom: 1px solid #34495e;
}

.sidebar-header h1 {
    font-size: 18px;
    margin-bottom: 8px;
}

.sidebar-header p {
    font-size: 12px;
    opacity: 0.8;
}

.control-section {
    flex: 1;
    overflow-y: auto;
    padding: 16px;
}

.control-group {
    margin-bottom: 24px;
}

.control-group h3 {
    font-size: 14px;
    margin-bottom: 12px;
    color: #ecf0f1;
}

.btn {
    width: 100%;
    padding: 10px;
    margin-bottom: 8px;
    border: none;
    border-radius: 6px;
    cursor: pointer;
    font-size: 13px;
    font-weight: 500;
    transition: all 0.2s;
}

.btn-primary {
    background: #3498db;
    color: white;
}

.btn-primary:hover {
    background: #2980b9;
}

.btn-success {
    background: #27ae60;
    color: white;
}

.btn-success:hover {
    background: #229954;
}

.btn-warning {
    background: #f39c12;
    color: white;
}

.btn-warning:hover {
    background: #e67e22;
}

.log-section {
    height: 200px;
    background: #1a1a1a;
    border-top: 1px solid #34495e;
    overflow-y: auto;
    padding: 12px;
    font-family: 'Courier New', monospace;
    font-size: 11px;
}

.log-item {
    margin-bottom: 4px;
    color: #95a5a6;
}

.log-success { color: #2ecc71; }
.log-error { color: #e74c3c; }
.log-info { color: #3498db; }

.main-area {
    flex: 1;
    display: flex;
    flex-direction: column;
}

.toolbar {
    background: #2d2d2d;
    padding: 12px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-bottom: 1px solid #3e3e3e;
}

.toolbar-left {
    display: flex;
    gap: 12px;
    align-items: center;
}

.workflow-info {
    display: flex;
    flex-direction: column;
    gap: 4px;
    padding: 6px 12px;
    background: #34495e;
    border-radius: 6px;
    font-size: 12px;
    color: #ecf0f1;
}

.workflow-name {
    font-weight: 500;
}

.workflow-status {
    font-size: 11px;
    color: #27ae60;
}

.toolbar-btn {
    padding: 8px 16px;
    background: #555;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 13px;
}

.toolbar-btn:hover {
    background: #666;
}

.iframe-container {
    flex: 1;
    position: relative;
    overflow: hidden;
}

iframe {
    width: 100%;
    height: 100%;
    border: none;
}
</style>
</head>
<body>
<div class="sidebar">
    <div class="sidebar-header">
        <h1>ğŸ§ª ç»¼åˆé›†æˆæµ‹è¯•</h1>
        <p>æ¨¡æ‹ŸçœŸå®å¹³å°ç¯å¢ƒ</p>
    </div>

    <div class="control-section">
        <div class="control-group">
            <h3>ğŸ“¤ å‘é€æ¶ˆæ¯åˆ° iframe</h3>
            <button class="btn btn-primary" onclick="sendTestMessage()">å‘é€æµ‹è¯•æ¶ˆæ¯</button>
            <button class="btn btn-primary" onclick="sendGetWorkflow()">è¯·æ±‚å·¥ä½œæµ</button>
        </div>

        <div class="control-group">
            <h3>ğŸ”Œ API è°ƒç”¨</h3>
            <button class="btn btn-success" onclick="getSystemStats()">è·å–ç³»ç»ŸçŠ¶æ€</button>
            <button class="btn btn-success" onclick="getQueue()">è·å–é˜Ÿåˆ—</button>
            <button class="btn btn-success" onclick="getHistory()">è·å–å†å²</button>
        </div>

        <div class="control-group">
            <h3>ğŸ’¾ å·¥ä½œæµæ“ä½œ</h3>
            <button class="btn btn-warning" onclick="saveWorkflow()">ä¿å­˜å·¥ä½œæµ</button>
            <button class="btn btn-warning" onclick="loadWorkflow()">åŠ è½½å·¥ä½œæµ</button>
        </div>
    </div>

    <div class="log-section" id="logSection">
        <div class="log-item log-info">[INFO] æµ‹è¯•ç¯å¢ƒå·²å°±ç»ª</div>
    </div>
</div>

<div class="main-area">
    <div class="toolbar">
        <div class="toolbar-left">
            <div class="workflow-info">
                <div class="workflow-name">ğŸ“ æµ‹è¯•å·¥ä½œæµ</div>
                <div class="workflow-status">ğŸŸ¢ å·²ä¿å­˜</div>
            </div>
            <button class="toolbar-btn" onclick="saveWorkflow()">ğŸ’¾ ä¿å­˜</button>
            <button class="toolbar-btn" onclick="loadWorkflow()">ğŸ“¥ åŠ è½½</button>
        </div>
    </div>

    <div class="iframe-container">
        <iframe src="http://127.0.0.1:8188/" id="comfyuiFrame"></iframe>
    </div>
</div>

<script>
const API_BASE = 'http://127.0.0.1:8188';

function addLog(message, type = 'info') {
    const logSection = document.getElementById('logSection');
    const logItem = document.createElement('div');
    logItem.className = `log-item log-${type}`;
    logItem.textContent = `[${type.toUpperCase()}] ${message}`;
    logSection.appendChild(logItem);
    logSection.scrollTop = logSection.scrollHeight;
}

// postMessage é€šä¿¡
function sendTestMessage() {
    const iframe = document.getElementById('comfyuiFrame');
    iframe.contentWindow.postMessage({ type: 'TEST', data: 'Hello' }, '*');
    addLog('å‘é€æµ‹è¯•æ¶ˆæ¯åˆ° iframe', 'info');
}

function sendGetWorkflow() {
    const iframe = document.getElementById('comfyuiFrame');
    iframe.contentWindow.postMessage({ type: 'GET_WORKFLOW' }, '*');
    addLog('è¯·æ±‚ iframe è¿”å›å·¥ä½œæµæ•°æ®', 'info');
}

// ç›‘å¬ iframe æ¶ˆæ¯
window.addEventListener('message', function(event) {
    addLog(`æ”¶åˆ° iframe æ¶ˆæ¯: ${JSON.stringify(event.data)}`, 'success');
});

// API è°ƒç”¨
async function apiCall(endpoint) {
    try {
        const response = await fetch(`${API_BASE}${endpoint}`);
        const data = await response.json();
        addLog(`API è°ƒç”¨æˆåŠŸ: ${endpoint}`, 'success');
        console.log(data);
        return data;
    } catch (error) {
        addLog(`API è°ƒç”¨å¤±è´¥: ${error.message}`, 'error');
    }
}

function getSystemStats() {
    apiCall('/system_stats');
}

function getQueue() {
    apiCall('/queue');
}

function getHistory() {
    apiCall('/history');
}

// å·¥ä½œæµæ“ä½œ
function saveWorkflow() {
    addLog('ä¿å­˜å·¥ä½œæµåˆ°å¹³å°æ•°æ®åº“ï¼ˆæ¨¡æ‹Ÿï¼‰', 'success');
    alert('âœ… å·¥ä½œæµå·²ä¿å­˜åˆ°å¹³å°æ•°æ®åº“ï¼');
}

function loadWorkflow() {
    addLog('ä»å¹³å°æ•°æ®åº“åŠ è½½å·¥ä½œæµï¼ˆæ¨¡æ‹Ÿï¼‰', 'info');
    alert('ğŸ“¥ å·¥ä½œæµå·²ä»å¹³å°æ•°æ®åº“åŠ è½½ï¼');
}

addLog('ç»¼åˆæµ‹è¯•ç¯å¢ƒå·²å¯åŠ¨', 'success');
</script>
</body>
</html>
