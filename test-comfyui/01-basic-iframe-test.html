<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æµ‹è¯• 1: åŸºç¡€ iframe åµŒå…¥æµ‹è¯•</title>
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }

body {
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    padding: 20px;
    background: #f5f6fa;
}

.test-container {
    max-width: 1400px;
    margin: 0 auto;
}

.test-header {
    background: white;
    padding: 20px;
    border-radius: 8px;
    margin-bottom: 20px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.test-header h1 {
    font-size: 24px;
    color: #2c3e50;
    margin-bottom: 10px;
}

.test-header p {
    color: #7f8c8d;
    font-size: 14px;
    line-height: 1.6;
}

.test-status {
    display: flex;
    gap: 12px;
    margin-top: 16px;
}

.status-item {
    padding: 8px 16px;
    border-radius: 6px;
    font-size: 13px;
    font-weight: 500;
}

.status-item.pending {
    background: #fff3cd;
    color: #856404;
}

.status-item.success {
    background: #d4edda;
    color: #155724;
}

.status-item.error {
    background: #f8d7da;
    color: #721c24;
}

.iframe-container {
    background: white;
    border-radius: 8px;
    padding: 20px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.iframe-wrapper {
    border: 2px solid #e0e0e0;
    border-radius: 6px;
    overflow: hidden;
    height: 800px;
}

iframe {
    width: 100%;
    height: 100%;
    border: none;
}

.test-info {
    background: #e8f4f8;
    border-left: 4px solid #3498db;
    padding: 16px;
    margin-top: 20px;
    border-radius: 4px;
}

.test-info h3 {
    font-size: 16px;
    color: #2c3e50;
    margin-bottom: 8px;
}

.test-info ul {
    margin-left: 20px;
    color: #555;
    font-size: 14px;
    line-height: 1.8;
}

.console-output {
    background: #2c3e50;
    color: #ecf0f1;
    padding: 16px;
    border-radius: 6px;
    margin-top: 20px;
    font-family: 'Courier New', monospace;
    font-size: 13px;
    max-height: 200px;
    overflow-y: auto;
}

.console-output .log-item {
    margin-bottom: 8px;
    padding: 4px 0;
    border-bottom: 1px solid #34495e;
}

.console-output .log-time {
    color: #95a5a6;
    margin-right: 8px;
}

.console-output .log-success {
    color: #2ecc71;
}

.console-output .log-error {
    color: #e74c3c;
}

.console-output .log-info {
    color: #3498db;
}
</style>
</head>
<body>
<div class="test-container">
    <div class="test-header">
        <h1>ğŸ§ª æµ‹è¯• 1: åŸºç¡€ iframe åµŒå…¥æµ‹è¯•</h1>
        <p>æµ‹è¯•ç›®æ ‡ï¼šéªŒè¯ ComfyUI æ˜¯å¦å…è®¸è¢« iframe åµŒå…¥ï¼Œæ£€æµ‹æ˜¯å¦æœ‰ X-Frame-Options æˆ– CSP é™åˆ¶ã€‚</p>

        <div class="test-status">
            <div class="status-item pending" id="loadStatus">â³ åŠ è½½çŠ¶æ€: ç­‰å¾…ä¸­...</div>
            <div class="status-item pending" id="errorStatus">âŒ é”™è¯¯æ£€æµ‹: ç­‰å¾…ä¸­...</div>
        </div>
    </div>

    <div class="iframe-container">
        <h2 style="margin-bottom: 16px; color: #2c3e50;">ComfyUI iframe åµŒå…¥åŒºåŸŸ</h2>
        <div class="iframe-wrapper">
            <iframe
                src="http://127.0.0.1:8188/"
                id="comfyuiFrame"
                onload="handleIframeLoad()"
                onerror="handleIframeError()"
            ></iframe>
        </div>
    </div>

    <div class="test-info">
        <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
        <ul>
            <li><strong>æˆåŠŸæ ‡å¿—ï¼š</strong>iframe ä¸­èƒ½æ­£å¸¸æ˜¾ç¤º ComfyUI ç•Œé¢ï¼Œå¯ä»¥çœ‹åˆ°èŠ‚ç‚¹ç¼–è¾‘å™¨</li>
            <li><strong>å¤±è´¥æ ‡å¿—ï¼š</strong>iframe æ˜¾ç¤ºç©ºç™½ã€é”™è¯¯ä¿¡æ¯æˆ–è¢«æµè§ˆå™¨é˜»æ­¢</li>
            <li><strong>å¸¸è§é—®é¢˜ï¼š</strong>
                <ul>
                    <li>X-Frame-Options: DENY - å®Œå…¨ç¦æ­¢ iframe åµŒå…¥</li>
                    <li>X-Frame-Options: SAMEORIGIN - åªå…è®¸åŒåŸŸååµŒå…¥</li>
                    <li>CSP frame-ancestors - å†…å®¹å®‰å…¨ç­–ç•¥é™åˆ¶</li>
                </ul>
            </li>
        </ul>
    </div>

    <div class="console-output" id="consoleOutput">
        <div class="log-item">
            <span class="log-time">[00:00:00]</span>
            <span class="log-info">æµ‹è¯•å¼€å§‹...</span>
        </div>
    </div>
</div>

<script>
let startTime = Date.now();

function getTimestamp() {
    const elapsed = Date.now() - startTime;
    const seconds = Math.floor(elapsed / 1000);
    const ms = elapsed % 1000;
    return `[${String(seconds).padStart(2, '0')}:${String(ms).padStart(3, '0')}]`;
}

function addLog(message, type = 'info') {
    const consoleOutput = document.getElementById('consoleOutput');
    const logItem = document.createElement('div');
    logItem.className = 'log-item';

    const timestamp = document.createElement('span');
    timestamp.className = 'log-time';
    timestamp.textContent = getTimestamp();

    const content = document.createElement('span');
    content.className = `log-${type}`;
    content.textContent = message;

    logItem.appendChild(timestamp);
    logItem.appendChild(content);
    consoleOutput.appendChild(logItem);

    // è‡ªåŠ¨æ»šåŠ¨åˆ°åº•éƒ¨
    consoleOutput.scrollTop = consoleOutput.scrollHeight;
}

function handleIframeLoad() {
    addLog('âœ… iframe onload äº‹ä»¶è§¦å‘', 'success');

    const loadStatus = document.getElementById('loadStatus');
    loadStatus.className = 'status-item success';
    loadStatus.textContent = 'âœ… åŠ è½½çŠ¶æ€: æˆåŠŸ';

    // å°è¯•è®¿é—® iframe å†…å®¹ï¼ˆæµ‹è¯•è·¨åŸŸï¼‰
    setTimeout(() => {
        try {
            const iframe = document.getElementById('comfyuiFrame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;

            if (iframeDoc) {
                addLog('âœ… å¯ä»¥è®¿é—® iframe å†…å®¹ï¼ˆåŒåŸŸï¼‰', 'success');
                addLog(`   iframe æ ‡é¢˜: ${iframeDoc.title}`, 'info');

                const errorStatus = document.getElementById('errorStatus');
                errorStatus.className = 'status-item success';
                errorStatus.textContent = 'âœ… é”™è¯¯æ£€æµ‹: æ— é”™è¯¯';
            }
        } catch (e) {
            addLog('âš ï¸ æ— æ³•è®¿é—® iframe å†…å®¹ï¼ˆè·¨åŸŸé™åˆ¶ï¼‰', 'error');
            addLog(`   é”™è¯¯ä¿¡æ¯: ${e.message}`, 'error');
            addLog('   è¿™æ˜¯æ­£å¸¸çš„è·¨åŸŸä¿æŠ¤ï¼Œä¸å½±å“ iframe æ˜¾ç¤º', 'info');

            const errorStatus = document.getElementById('errorStatus');
            errorStatus.className = 'status-item success';
            errorStatus.textContent = 'âœ… é”™è¯¯æ£€æµ‹: è·¨åŸŸä¿æŠ¤ï¼ˆæ­£å¸¸ï¼‰';
        }
    }, 1000);
}

function handleIframeError() {
    addLog('âŒ iframe onerror äº‹ä»¶è§¦å‘', 'error');

    const loadStatus = document.getElementById('loadStatus');
    loadStatus.className = 'status-item error';
    loadStatus.textContent = 'âŒ åŠ è½½çŠ¶æ€: å¤±è´¥';

    const errorStatus = document.getElementById('errorStatus');
    errorStatus.className = 'status-item error';
    errorStatus.textContent = 'âŒ é”™è¯¯æ£€æµ‹: åŠ è½½å¤±è´¥';
}

// ç›‘å¬æ§åˆ¶å°é”™è¯¯
window.addEventListener('error', function(e) {
    if (e.message.includes('frame')) {
        addLog(`âŒ æµè§ˆå™¨é”™è¯¯: ${e.message}`, 'error');
    }
});

// è¶…æ—¶æ£€æµ‹
setTimeout(() => {
    const loadStatus = document.getElementById('loadStatus');
    if (loadStatus.textContent.includes('ç­‰å¾…ä¸­')) {
        addLog('âš ï¸ åŠ è½½è¶…æ—¶ï¼ˆ10ç§’ï¼‰ï¼Œå¯èƒ½å­˜åœ¨é—®é¢˜', 'error');
        loadStatus.className = 'status-item error';
        loadStatus.textContent = 'âš ï¸ åŠ è½½çŠ¶æ€: è¶…æ—¶';
    }
}, 10000);

addLog('ğŸš€ å¼€å§‹åŠ è½½ ComfyUI iframe...', 'info');
addLog(`   ç›®æ ‡åœ°å€: http://127.0.0.1:8188/`, 'info');
</script>
</body>
</html>
