---
description: 项目所使用的技术栈以及官方文档
globs:
alwaysApply: true
---

# 技术栈规范

## 数据库表设计规范
- 数据库表普通表主键字段使用bigint类型，java侧对应使用mybatis-plus框架自动使用雪花算法生成的Long类型，返回给前端时则是在json序列化步骤里序列化成string
- 所有的库表不允许直接定义为外键约束，而是在代码层面控制外键约束语义
- 数据库内禁止使用存储过程和触发器，需要自动填充的字段使用mybatis-plus框架的自动填充功能在代码层面填充

## 代码规范
- 项目采用经典的 DDD 四层架构
- 转换层统一使用mapstruct封装转换器进行转换，转换器使用`@Mapper(componentModel = "spring")`注解标识

### 对象转换规则

#### 1 DTO (Data Transfer Object)
- 用于接口层和应用层之间的数据传输
- 面向外部接口设计
- 可包含多个实体的组合数据

#### 2 Entity (领域实体)
- 领域层的核心对象
- 包含业务逻辑和业务规则
- 具有唯一标识

#### 3 PO (Persistent Object)
- 与数据库表一一对应
- 仅用于持久化
- 不包含业务逻辑

#### 4 转换流程

```
外部请求 → DTO → Entity → PO → 数据库
数据库 → PO → Entity → DTO → 外部响应
```

### 分层调用规则

```
✅ 允许的调用方向：
Controller → ApplicationService → DomainEntity → Repository

❌ 禁止的调用：
- 跨层调用（如 Controller 直接调用 Repository）
- 反向调用（如 Domain 调用 Application）
- 基础设施层调用领域层
```

### 创建新功能的步骤

1. **定义领域实体**（domain/entity）
2. **定义仓储接口**（domain/repository）
3. **创建持久化对象**（infrastructure/persistence/po）
4. **实现 Mapper 接口**（infrastructure/persistence/mapper）
5. **编写 Mapper XML**（resources/mapper）
6. **实现仓储接口**（infrastructure/persistence/repository）
7. **创建应用服务**（application/service）
8. **定义 DTO**（application/dto）
9. **创建控制器**（interfaces/controller）
10. **编写 Assembler**（interfaces/assembler）

## 其他规范
- 项目已集成 PGVector 扩展，用于向量相似度搜索，默认使用的数据库启用了PGVector插件
- 已配置 PostgreSQL 分页插件：最大单页限制：1000 条，超出最大页不回到首页
- 事务边界设置在 **应用层（ApplicationService）**
- 使用 `@Transactional` 注解
- 领域层不直接处理事务
- 领域层抛出领域异常
- 应用层捕获并转换为应用异常
- 接口层统一处理异常并返回标准响应