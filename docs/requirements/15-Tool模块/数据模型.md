# Tool 模块 - 数据模型

## 1. 模块说明

Tool 模块是纯代码实现的模块，**不涉及数据库表设计**。所有数据结构都是内存中的值对象和枚举类型。

---

## 2. 核心数据结构

### 2.1 ToolType 枚举

**说明**：工具类型枚举

**字段**：
- `code` (String) - 工具类型代码
- `description` (String) - 工具类型描述

**枚举值**：
| 枚举值 | code | description |
|--------|------|-------------|
| LLM | llm | 大语言模型工具 |
| EMBEDDING | embedding | 向量生成工具 |
| CLASSIFICATION | classification | 文本分类工具 |
| SENTIMENT_ANALYSIS | sentiment_analysis | 情感分析工具 |
| ENTITY_RECOGNITION | entity_recognition | 实体识别工具 |
| RERANK | rerank | 重排序工具 |

---

### 2.2 ToolExecutionResult 值对象

**说明**：工具执行结果

**字段**：
| 字段名 | 类型 | 说明 |
|--------|------|------|
| success | boolean | 是否执行成功 |
| data | Map<String, Object> | 执行结果数据 |
| errorMessage | String | 错误信息（失败时） |
| metadata | ToolExecutionMetadata | 执行元数据 |

**示例**：
```json
{
  "success": true,
  "data": {
    "text": "生成的文本内容",
    "model": "gpt-3.5-turbo",
    "finish_reason": "stop"
  },
  "errorMessage": null,
  "metadata": {
    "toolType": "llm",
    "toolName": "llm",
    "executionTimeMs": 1500,
    "modelUsed": "gpt-3.5-turbo",
    "inputTokens": 10,
    "outputTokens": 50,
    "tokenUsed": 60
  }
}
```

---

### 2.3 ToolExecutionMetadata 值对象

**说明**：工具执行元数据

**字段**：
| 字段名 | 类型 | 说明 |
|--------|------|------|
| toolType | String | 工具类型 |
| toolName | String | 工具名称 |
| executionTimeMs | Long | 执行时间（毫秒） |
| modelUsed | String | 使用的模型标识 |
| tokenUsed | Integer | 总 Token 使用量 |
| inputTokens | Integer | 输入 Token 数量 |
| outputTokens | Integer | 输出 Token 数量 |

---

## 3. 工具参数 Schema

### 3.1 LlmTool 参数

**JSON Schema**：
```json
{
  "type": "object",
  "properties": {
    "prompt": {
      "type": "string",
      "description": "输入的提示文本"
    },
    "temperature": {
      "type": "number",
      "description": "温度参数，控制输出的随机性，范围 0-2",
      "minimum": 0,
      "maximum": 2,
      "default": 0.7
    },
    "max_tokens": {
      "type": "integer",
      "description": "最大生成的 token 数量",
      "minimum": 1,
      "default": 2000
    }
  },
  "required": ["prompt"]
}
```

**参数说明**：
| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| prompt | string | 是 | - | 输入的提示文本 |
| temperature | number | 否 | 0.7 | 温度参数，范围 0-2 |
| max_tokens | integer | 否 | 2000 | 最大生成的 token 数量 |

---

### 3.2 EmbeddingTool 参数

**JSON Schema**：
```json
{
  "type": "object",
  "properties": {
    "text": {
      "type": "string",
      "description": "需要向量化的文本"
    }
  },
  "required": ["text"]
}
```

**参数说明**：
| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| text | string | 是 | - | 需要向量化的文本 |

---

## 4. 工具返回结果

### 4.1 LlmTool 返回结果

**结构**：
```json
{
  "success": true,
  "data": {
    "text": "生成的文本内容",
    "finish_reason": "stop",
    "model": "gpt-3.5-turbo",
    "input_tokens": 10,
    "output_tokens": 50,
    "total_tokens": 60
  },
  "metadata": {
    "toolType": "llm",
    "toolName": "llm",
    "executionTimeMs": 1500,
    "modelUsed": "gpt-3.5-turbo",
    "inputTokens": 10,
    "outputTokens": 50,
    "tokenUsed": 60
  }
}
```

**data 字段说明**：
| 字段名 | 类型 | 说明 |
|--------|------|------|
| text | string | 生成的文本内容 |
| finish_reason | string | 完成原因（stop/length） |
| model | string | 使用的模型标识 |
| input_tokens | integer | 输入 Token 数量 |
| output_tokens | integer | 输出 Token 数量 |
| total_tokens | integer | 总 Token 数量 |

---

### 4.2 EmbeddingTool 返回结果

**结构**：
```json
{
  "success": true,
  "data": {
    "vector": [0.1, 0.2, 0.3, ...],
    "dimension": 1536,
    "model": "text-embedding-ada-002"
  },
  "metadata": {
    "toolType": "embedding",
    "toolName": "embedding",
    "executionTimeMs": 500,
    "modelUsed": "text-embedding-ada-002"
  }
}
```

**data 字段说明**：
| 字段名 | 类型 | 说明 |
|--------|------|------|
| vector | array | 向量数组 |
| dimension | integer | 向量维度 |
| model | string | 使用的模型标识 |

---

## 5. 数据流转

### 5.1 工具执行流程

```
1. Agent 构造参数 Map
   ↓
2. ToolExecutor 接收参数
   ↓
3. ToolRegistry 查找 Tool
   ↓
4. Tool 验证参数
   ↓
5. Tool 调用 ModelCapabilityService
   ↓
6. 构建 ToolExecutionResult
   ↓
7. 返回给 Agent
```

### 5.2 数据转换

```
Agent 参数 (Map)
   ↓
ModelCapabilityRequest
   ↓
ModelExecutor 执行
   ↓
ModelCapabilityResponse
   ↓
ToolExecutionResult
   ↓
返回给 Agent
```

---

## 6. 设计说明

### 6.1 为什么不使用数据库

Tool 模块的特点：
- 工具定义是代码级别的
- 工具实例在内存中管理
- 不需要持久化存储
- 通过 Spring Bean 自动注册

### 6.2 扩展性考虑

如果未来需要支持动态工具配置，可以考虑：
- 添加 tool_config 表存储工具配置
- 支持工具的启用/禁用
- 支持工具参数的动态配置

但当前阶段，代码级别的工具定义已经足够。
