# Tool 模块 - 模块设计

## 1. 模块概述

### 1.1 模块定位
Tool 模块是 Agent 与 Model 之间的桥梁层，为 Agent 提供统一的工具调用接口，封装底层模型能力。

### 1.2 核心职责
- 提供统一的工具接口定义
- 封装模型能力为可调用的工具
- 管理工具的注册和查找
- 执行工具并返回标准化结果

### 1.3 设计原则
- **工具即能力**：每个 Tool 封装一种特定能力
- **统一接口**：所有 Tool 实现统一的接口
- **参数标准化**：使用 JSON Schema 定义工具参数
- **结果标准化**：统一的执行结果格式
- **可扩展性**：易于添加新的工具类型

---

## 2. 架构设计

### 2.1 整体架构

```
┌─────────────────────────────────────────────────────────┐
│                    Agent Layer (决策层)                   │
│              Agent 决策使用哪个 Tool                       │
└────────────────────┬────────────────────────────────────┘
                     │
                     ↓
┌─────────────────────────────────────────────────────────┐
│                  Tool Layer (工具层)                      │
│  ┌─────────────────────────────────────────────────┐   │
│  │  1. Tool 接口层                                  │   │
│  │     - Tool 接口定义                              │   │
│  │     - ToolType 枚举                             │   │
│  │     - 参数和结果格式                             │   │
│  └─────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────┐   │
│  │  2. Tool 实现层                                  │   │
│  │     - LlmTool (文本生成)                        │   │
│  │     - EmbeddingTool (向量生成)                  │   │
│  └─────────────────────────────────────────────────┘   │
│  ┌─────────────────────────────────────────────────┐   │
│  │  3. Tool 管理层                                  │   │
│  │     - ToolRegistry (工具注册)                   │   │
│  │     - ToolExecutor (工具执行)                   │   │
│  └─────────────────────────────────────────────────┘   │
└────────────────────┬────────────────────────────────────┘
                     │
                     ↓
┌─────────────────────────────────────────────────────────┐
│          Model Capability Layer (模型能力层)              │
│              ModelCapabilityService                      │
└─────────────────────────────────────────────────────────┘
```

### 2.2 调用流程

```
Agent
  ↓ 1. 选择 Tool
ToolExecutor
  ↓ 2. 查找 Tool 实例
ToolRegistry
  ↓ 3. 执行 Tool
Tool (LlmTool/EmbeddingTool)
  ↓ 4. 调用模型能力
ModelCapabilityService
  ↓ 5. 路由到具体模型
CapabilityRouter
  ↓ 6. 执行模型推理
ModelExecutor (OpenAiExecutor)
  ↓ 7. 返回结果
Tool → Agent
```

---

## 3. 核心组件

### 3.1 Tool 接口

**职责**：定义工具的统一接口

**核心方法**：
- `getType()` - 获取工具类型
- `getName()` - 获取工具名称
- `getDescription()` - 获取工具描述
- `getParameterSchema()` - 获取参数 Schema
- `execute(parameters)` - 执行工具

### 3.2 ToolRegistry

**职责**：工具注册中心，管理所有工具实例

**核心功能**：
- 自动注册所有 Tool Bean
- 按类型查找工具
- 按名称查找工具
- 获取所有工具列表

### 3.3 ToolExecutor

**职责**：工具执行器，统一的工具执行入口

**核心功能**：
- 按类型执行工具
- 按名称执行工具
- 记录执行时间
- 异常处理和错误返回

---

## 4. 工具类型

### 4.1 已实现工具

#### LlmTool - 大语言模型工具
- **能力**：文本生成和对话
- **参数**：prompt, temperature, max_tokens
- **返回**：生成的文本、token 使用信息

#### EmbeddingTool - 向量生成工具
- **能力**：文本向量化
- **参数**：text
- **返回**：向量数组、维度信息

### 4.2 预留工具类型

- **ClassificationTool** - 文本分类工具
- **SentimentAnalysisTool** - 情感分析工具
- **EntityRecognitionTool** - 实体识别工具
- **RerankTool** - 重排序工具

---

## 5. 数据结构

### 5.1 ToolExecutionResult

工具执行结果：
- `success` - 是否成功
- `data` - 结果数据
- `errorMessage` - 错误信息
- `metadata` - 执行元数据

### 5.2 ToolExecutionMetadata

执行元数据：
- `toolType` - 工具类型
- `toolName` - 工具名称
- `executionTimeMs` - 执行时间
- `modelUsed` - 使用的模型
- `tokenUsed` - Token 使用量

---

## 6. 依赖关系

### 6.1 依赖的模块
- **Model 模块**：调用 ModelCapabilityService

### 6.2 被依赖的模块
- **Agent 模块**：Agent 调用 ToolExecutor

---

## 7. 扩展性设计

### 7.1 添加新工具

1. 实现 Tool 接口
2. 添加 @Component 注解
3. 实现 execute() 方法
4. 定义参数 Schema

### 7.2 集成新能力

1. 在 Model 模块添加新的 ModelCapability
2. 实现对应的 ModelExecutor
3. 创建对应的 Tool 实现

---

## 8. 设计优势

### 8.1 解耦性
- Agent 不直接依赖 Model
- Tool 作为中间层隔离变化

### 8.2 可扩展性
- 易于添加新工具
- 易于集成新能力

### 8.3 标准化
- 统一的接口定义
- 统一的参数和结果格式

### 8.4 可维护性
- 清晰的职责划分
- 自动化的工具注册
