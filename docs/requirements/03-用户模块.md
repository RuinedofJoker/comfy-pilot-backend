# 用户模块设计

## 模块职责
- 用户认证与授权
- JWT Token 管理
- 用户信息管理
- 权限控制

## 核心组件

### Domain 层
- **User**: 用户实体
- **UserPermission**: 用户权限实体
- **UserRepository**: 用户仓储接口

### Infrastructure 层
- **UserRepositoryImpl**: 用户仓储实现
- **UserMapper**: MyBatis-Plus Mapper
- **JwtTokenProvider**: JWT Token 生成与验证
- **PasswordEncoder**: BCrypt 密码加密

### Application 层
- **AuthService**: 认证服务
  - 登录认证
  - Token 刷新
  - 登出处理
- **UserService**: 用户服务
  - 用户信息查询
  - 用户信息更新
  - 密码修改

### Interface 层
- **AuthController**: 认证接口
- **UserController**: 用户管理接口

## 核心流程

### 登录流程
1. 接收用户名密码
2. 验证用户名密码
3. 生成 JWT Token
4. 记录登录日志
5. 返回 Token 和用户信息

### Token 验证流程
1. 从请求头获取 Token
2. 验证 Token 有效性
3. 检查 Token 黑名单
4. 解析用户信息
5. 设置安全上下文

### 权限验证流程
1. 获取当前用户
2. 查询用户权限
3. 验证资源权限
4. 返回验证结果

## 安全策略

### Token 策略
- 有效期: 24小时
- 刷新机制: 支持 Token 刷新
- 黑名单: 登出后加入黑名单

### 密码策略
- 加密算法: BCrypt
- 最小长度: 8位
- 复杂度要求: 字母+数字

### 会话策略
- 单点登录: 不支持
- 并发登录: 允许
- 登录失败锁定: 5次失败锁定30分钟
