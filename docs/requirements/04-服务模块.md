# 服务模块设计

## 模块职责
- ComfyUI 服务实例管理
- 服务状态监控
- 服务连接测试

## 核心组件

### Domain 层
- **ComfyUIService**: 服务实体
- **ServiceRepository**: 服务仓储接口

### Infrastructure 层
- **ServiceRepositoryImpl**: 服务仓储实现
- **ServiceMapper**: MyBatis-Plus Mapper
- **ComfyUIClient**: ComfyUI HTTP 客户端

### Application 层
- **ServiceManagementService**: 服务管理
  - 服务 CRUD
  - 服务状态检测
  - 连接测试
- **ServiceMonitorScheduler**: 定时监控任务
  - 每分钟检测服务状态
  - 更新服务状态

### Interface 层
- **ServiceController**: 服务管理接口

## 核心流程

### 服务状态检测
1. 发送 HTTP 请求到 ComfyUI
2. 检查响应状态
3. 更新服务状态
4. 记录检测时间

### 服务删除检查
1. 检查是否有关联工作流
2. 如有关联则拒绝删除
3. 执行删除操作

## 监控策略
- 检测频率: 每分钟
- 超时时间: 5秒
- 失败重试: 3次
