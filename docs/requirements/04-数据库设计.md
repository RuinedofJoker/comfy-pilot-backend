# 数据库设计

## workflow 表

```sql
CREATE TABLE workflow (
    id BIGINT NOT NULL,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    workflow_data JSONB NOT NULL,
    status VARCHAR(20) NOT NULL DEFAULT 'DRAFT',
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    created_by BIGINT,
    updated_by BIGINT,
    deleted SMALLINT NOT NULL DEFAULT 0,
    PRIMARY KEY (id)
);

CREATE INDEX idx_workflow_status ON workflow(status);
CREATE INDEX idx_workflow_deleted ON workflow(deleted);
```

## agent_conversation 表

```sql
CREATE TABLE agent_conversation (
    id BIGINT NOT NULL,
    workflow_id BIGINT,
    conversation_data JSONB,
    status VARCHAR(20) NOT NULL DEFAULT 'ACTIVE',
    created_at TIMESTAMP,
    updated_at TIMESTAMP,
    PRIMARY KEY (id)
);

CREATE INDEX idx_conversation_workflow_id ON agent_conversation(workflow_id);
CREATE INDEX idx_conversation_status ON agent_conversation(status);
```

## agent_message 表

```sql
CREATE TABLE agent_message (
    id BIGINT NOT NULL,
    conversation_id BIGINT NOT NULL,
    role VARCHAR(20) NOT NULL,
    content TEXT NOT NULL,
    metadata JSONB,
    created_at TIMESTAMP,
    PRIMARY KEY (id)
);

CREATE INDEX idx_message_conversation_id ON agent_message(conversation_id);
CREATE INDEX idx_message_created_at ON agent_message(created_at);
```

## 字段说明

- **id**: 使用雪花算法生成，由 MyBatis-Plus 自动填充
- **created_at/updated_at**: 由 MyBatis-Plus MetaObjectHandler 自动填充
- **JSONB 字段**: 使用 `JacksonTypeHandler` 处理
