# AI模型模块 - 数据模型

> 本文档定义AI模型模块相关的数据表设计

## 数据表

### 1. model_provider - AI模型提供商表

**表说明**: 存储AI模型提供商信息（如OpenAI、Anthropic等）

#### 字段定义

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | - | 主键ID |
| provider_name | VARCHAR | 100 | NO | - | 提供商名称 |
| provider_type | VARCHAR | 50 | NO | - | 提供商类型（openai/anthropic/aliyun/custom） |
| api_base_url | VARCHAR | 500 | YES | - | API基础URL |
| description | TEXT | - | YES | - | 描述信息 |
| is_enabled | BOOLEAN | - | NO | TRUE | 是否启用 |
| create_time | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 创建时间 |
| update_time | TIMESTAMP | - | YES | - | 更新时间 |
| create_by | BIGINT | - | YES | - | 创建人ID |
| update_by | BIGINT | - | YES | - | 更新人ID |

#### 索引设计

| 索引名 | 索引类型 | 字段 | 说明 |
|--------|----------|------|------|
| PRIMARY | PRIMARY KEY | id | 主键索引 |
| idx_provider_type | INDEX | provider_type | 提供商类型索引 |
| idx_is_enabled | INDEX | is_enabled | 启用状态索引 |

---

### 2. ai_model - AI模型表

**表说明**: 存储AI模型配置信息，支持远程API/本地接入 × LLM/Embedding等模型类型

#### 字段定义

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | - | 主键ID |
| model_name | VARCHAR | 100 | NO | - | 模型名称 |
| model_identifier | VARCHAR | 100 | NO | - | 模型标识符（唯一） |
| access_type | VARCHAR | 50 | NO | - | 接入方式（remote_api/local） |
| model_type | VARCHAR | 50 | NO | - | 模型类型（llm/embedding/sentiment_classification等） |
| model_source | VARCHAR | 50 | NO | remote_api | 模型来源（remote_api/code_defined） |
| provider_id | BIGINT | - | YES | - | 提供商ID（远程API时必填） |
| model_config | TEXT | - | YES | - | 模型配置（JSON格式） |
| description | TEXT | - | YES | - | 描述信息 |
| is_enabled | BOOLEAN | - | NO | TRUE | 是否启用 |
| create_time | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 创建时间 |
| update_time | TIMESTAMP | - | YES | - | 更新时间 |
| create_by | BIGINT | - | YES | - | 创建人ID |
| update_by | BIGINT | - | YES | - | 更新人ID |

#### 索引设计

| 索引名 | 索引类型 | 字段 | 说明 |
|--------|----------|------|------|
| PRIMARY | PRIMARY KEY | id | 主键索引 |
| uk_model_identifier | UNIQUE | model_identifier | 模型标识符唯一索引 |
| idx_access_type | INDEX | access_type | 接入方式索引 |
| idx_model_type | INDEX | model_type | 模型类型索引 |
| idx_model_source | INDEX | model_source | 模型来源索引 |
| idx_provider_id | INDEX | provider_id | 提供商ID索引 |
| idx_is_enabled | INDEX | is_enabled | 启用状态索引 |

#### 外键约束

| 外键名 | 字段 | 引用表 | 引用字段 | 说明 |
|--------|------|--------|----------|------|
| fk_ai_model_provider | provider_id | model_provider | id | 关联提供商 |

---

### 3. model_api_key - 模型API密钥表

**表说明**: 存储模型提供商的API密钥信息（加密存储）

#### 字段定义

| 字段名 | 类型 | 长度 | 允许NULL | 默认值 | 说明 |
|--------|------|------|----------|--------|------|
| id | BIGINT | - | NO | - | 主键ID |
| provider_id | BIGINT | - | NO | - | 提供商ID |
| key_name | VARCHAR | 100 | NO | - | 密钥名称 |
| api_key | VARCHAR | 500 | NO | - | API密钥（加密存储） |
| is_enabled | BOOLEAN | - | NO | TRUE | 是否启用 |
| create_time | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 创建时间 |
| update_time | TIMESTAMP | - | YES | - | 更新时间 |
| create_by | BIGINT | - | YES | - | 创建人ID |
| update_by | BIGINT | - | YES | - | 更新人ID |

#### 索引设计

| 索引名 | 索引类型 | 字段 | 说明 |
|--------|----------|------|------|
| PRIMARY | PRIMARY KEY | id | 主键索引 |
| idx_provider_id | INDEX | provider_id | 提供商ID索引 |
| idx_is_enabled | INDEX | is_enabled | 启用状态索引 |

#### 外键约束

| 外键名 | 字段 | 引用表 | 引用字段 | 说明 |
|--------|------|--------|----------|------|
| fk_model_api_key_provider | provider_id | model_provider | id | 关联提供商 |

---

## 数据关系图

```
model_provider (1) ----< (N) ai_model
       |
       |
       +----< (N) model_api_key
```

**关系说明**:
- 一个提供商可以有多个模型
- 一个提供商可以有多个API密钥
- 模型的 access_type 为 'remote_api' 时必须关联提供商
- 模型的 access_type 为 'local' 时不需要关联提供商

---

## 枚举值定义

### provider_type（提供商类型）

| 值 | 说明 |
|----|------|
| openai | OpenAI |
| anthropic | Anthropic |
| aliyun | 阿里云 |
| custom | 自定义 |

### access_type（接入方式）

| 值 | 说明 |
|----|------|
| remote_api | 远程API接入 |
| local | 本地接入 |

### model_type（模型类型）

| 值 | 说明 |
|----|------|
| llm | 大语言模型 |
| embedding | 嵌入模型 |
| sentiment_classification | 情感分类模型 |
| token_classification | Token分类模型 |
| image_generation | 图像生成模型 |
| speech_recognition | 语音识别模型 |
| text_to_speech | 文本转语音模型 |

### model_source（模型来源）

| 值 | 说明 |
|----|------|
| remote_api | 远程API创建（管理员可完全管理：创建/修改/删除） |
| code_defined | 代码预定义（管理员只能编辑基本信息，不能删除） |

---

**文档版本**: v1.0
**最后更新**: 2026-01-16

