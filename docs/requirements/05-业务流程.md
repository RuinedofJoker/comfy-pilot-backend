# 业务流程

## Agent 对话创建工作流

```
1. 用户发起对话
   ↓
   创建 AgentConversation（status: ACTIVE）

2. 用户发送消息："创建一个文生图工作流"
   ↓
   保存 AgentMessage（role: USER）

3. 系统调用 LLM 生成 ComfyUI JSON
   ↓
   创建 Workflow（status: DRAFT）

4. 保存 Agent 回复
   ↓
   保存 AgentMessage（role: ASSISTANT）

5. 返回工作流草稿给用户
   ↓
   用户查看并继续对话编辑

6. 用户满意后激活工作流
   ↓
   更新 Workflow（status: DRAFT → ACTIVE）
   更新 AgentConversation（status: ACTIVE → COMPLETED）
```

## 状态转换规则

### Workflow 状态转换
- `DRAFT` → `ACTIVE`: 用户激活工作流
- `ACTIVE` → `DRAFT`: 用户重新编辑（可选功能）

### Conversation 状态转换
- `ACTIVE` → `COMPLETED`: 用户完成对话或激活工作流
