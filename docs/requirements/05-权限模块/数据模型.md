# 权限模块 - 数据模型

> 本文档定义权限模块相关的数据表设计

## 数据表

### role - 角色表

**表说明**: 存储系统角色信息

**表结构**:

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | BIGINT | - | NO | - | 主键ID |
| role_code | VARCHAR | 50 | NO | - | 角色编码（唯一） |
| role_name | VARCHAR | 100 | NO | - | 角色名称 |
| description | VARCHAR | 500 | YES | NULL | 角色描述 |
| is_system | BOOLEAN | - | NO | FALSE | 是否系统内置角色 |
| create_time | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 创建时间 |
| create_by | BIGINT | - | YES | NULL | 创建人ID |
| update_time | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 更新时间 |
| update_by | BIGINT | - | YES | NULL | 更新人ID |
| is_deleted | BOOLEAN | - | NO | FALSE | 逻辑删除标记 |

**索引设计**:

| 索引名 | 索引类型 | 字段 | 说明 |
|--------|----------|------|------|
| pk_role | PRIMARY KEY | id | 主键索引 |
| uk_role_code | UNIQUE | role_code | 角色编码唯一索引 |

**建表SQL**:

```sql
CREATE TABLE role (
    id BIGSERIAL PRIMARY KEY,
    role_code VARCHAR(50) NOT NULL,
    role_name VARCHAR(100) NOT NULL,
    description VARCHAR(500),
    is_system BOOLEAN NOT NULL DEFAULT FALSE,
    create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    create_by BIGINT,
    update_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    update_by BIGINT,
    is_deleted BOOLEAN NOT NULL DEFAULT FALSE,
    CONSTRAINT uk_role_code UNIQUE (role_code)
);
```

### permission - 权限表

**表说明**: 存储系统权限定义

**表结构**:

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | BIGINT | - | NO | - | 主键ID |
| permission_code | VARCHAR | 100 | NO | - | 权限编码（唯一） |
| permission_name | VARCHAR | 100 | NO | - | 权限名称 |
| resource_type | VARCHAR | 50 | NO | - | 资源类型 |
| description | VARCHAR | 500 | YES | NULL | 权限描述 |
| create_time | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 创建时间 |
| is_deleted | BOOLEAN | - | NO | FALSE | 逻辑删除标记 |

**索引设计**:

| 索引名 | 索引类型 | 字段 | 说明 |
|--------|----------|------|------|
| pk_permission | PRIMARY KEY | id | 主键索引 |
| uk_permission_code | UNIQUE | permission_code | 权限编码唯一索引 |

**建表SQL**:

```sql
CREATE TABLE permission (
    id BIGSERIAL PRIMARY KEY,
    permission_code VARCHAR(100) NOT NULL,
    permission_name VARCHAR(100) NOT NULL,
    resource_type VARCHAR(50) NOT NULL,
    description VARCHAR(500),
    create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    is_deleted BOOLEAN NOT NULL DEFAULT FALSE,
    CONSTRAINT uk_permission_code UNIQUE (permission_code)
);
```

### role_permission - 角色权限关联表

**表说明**: 存储角色与权限的多对多关系

**表结构**:

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | BIGINT | - | NO | - | 主键ID |
| role_id | BIGINT | - | NO | - | 角色ID |
| permission_id | BIGINT | - | NO | - | 权限ID |
| create_time | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 创建时间 |

**索引设计**:

| 索引名 | 索引类型 | 字段 | 说明 |
|--------|----------|------|------|
| pk_role_permission | PRIMARY KEY | id | 主键索引 |
| uk_role_permission | UNIQUE | role_id, permission_id | 角色权限唯一索引 |
| fk_role_permission_role | FOREIGN KEY | role_id | 外键：关联role表 |
| fk_role_permission_perm | FOREIGN KEY | permission_id | 外键：关联permission表 |

**建表SQL**:

```sql
CREATE TABLE role_permission (
    id BIGSERIAL PRIMARY KEY,
    role_id BIGINT NOT NULL,
    permission_id BIGINT NOT NULL,
    create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT uk_role_permission UNIQUE (role_id, permission_id),
    CONSTRAINT fk_role_permission_role FOREIGN KEY (role_id) REFERENCES role(id),
    CONSTRAINT fk_role_permission_perm FOREIGN KEY (permission_id) REFERENCES permission(id)
);
```

### user_role - 用户角色关联表

**表说明**: 存储用户与角色的多对多关系

**表结构**:

| 字段名 | 类型 | 长度 | 允许空 | 默认值 | 说明 |
|--------|------|------|--------|--------|------|
| id | BIGINT | - | NO | - | 主键ID |
| user_id | BIGINT | - | NO | - | 用户ID |
| role_id | BIGINT | - | NO | - | 角色ID |
| create_time | TIMESTAMP | - | NO | CURRENT_TIMESTAMP | 创建时间 |

**索引设计**:

| 索引名 | 索引类型 | 字段 | 说明 |
|--------|----------|------|------|
| pk_user_role | PRIMARY KEY | id | 主键索引 |
| uk_user_role | UNIQUE | user_id, role_id | 用户角色唯一索引 |
| idx_user_role_user_id | INDEX | user_id | 用户ID索引 |
| fk_user_role_user | FOREIGN KEY | user_id | 外键：关联user表 |
| fk_user_role_role | FOREIGN KEY | role_id | 外键：关联role表 |

**建表SQL**:

```sql
CREATE TABLE user_role (
    id BIGSERIAL PRIMARY KEY,
    user_id BIGINT NOT NULL,
    role_id BIGINT NOT NULL,
    create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT uk_user_role UNIQUE (user_id, role_id),
    CONSTRAINT fk_user_role_user FOREIGN KEY (user_id) REFERENCES "user"(id),
    CONSTRAINT fk_user_role_role FOREIGN KEY (role_id) REFERENCES role(id)
);

CREATE INDEX idx_user_role_user_id ON user_role(user_id);
```
