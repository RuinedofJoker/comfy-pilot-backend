# 资源模块 - 数据模型

> 本文档定义资源模块相关的数据表设计

## 数据表

### file_resource - 文件资源表

**表说明**: 存储上传文件的元数据信息

#### 字段定义

| 字段名 | 类型 | 约束 | 默认值 | 说明 |
|--------|------|------|--------|------|
| id | BIGINT | PRIMARY KEY | - | 主键ID（雪花算法） |
| file_name | VARCHAR(255) | NOT NULL | - | 原始文件名 |
| stored_name | VARCHAR(255) | NOT NULL | - | 存储文件名（唯一） |
| file_path | VARCHAR(500) | NOT NULL | - | 文件存储路径 |
| file_size | BIGINT | NOT NULL | - | 文件大小（字节） |
| file_type | VARCHAR(100) | NULL | - | 文件MIME类型 |
| file_extension | VARCHAR(50) | NULL | - | 文件扩展名 |
| upload_user_id | BIGINT | NOT NULL | - | 上传用户ID |
| business_type | VARCHAR(50) | NULL | - | 业务类型（workflow/avatar等） |
| business_id | BIGINT | NULL | - | 业务关联ID |
| download_count | INT | NULL | 0 | 下载次数 |
| create_time | TIMESTAMP | NOT NULL | CURRENT_TIMESTAMP | 创建时间 |
| create_by | BIGINT | NOT NULL | - | 创建人ID |
| update_time | TIMESTAMP | NOT NULL | CURRENT_TIMESTAMP | 更新时间 |
| update_by | BIGINT | NOT NULL | - | 更新人ID |
| is_deleted | BIGINT | NULL | 0 | 逻辑删除标记 |

#### 索引设计

| 索引名 | 类型 | 字段 | 说明 |
|--------|------|------|------|
| PRIMARY | 主键 | id | 主键索引 |
| idx_file_resource_upload_user_id | 普通 | upload_user_id | 查询用户文件 |
| idx_file_resource_business | 普通 | business_type, business_id | 查询业务文件 |
| idx_file_resource_stored_name | 唯一 | stored_name | 存储名唯一 |
| idx_file_resource_create_time | 普通 | create_time | 时间排序 |

#### 业务规则

1. **文件命名**: stored_name 使用 UUID + 原始扩展名
2. **逻辑删除**: 删除时标记 is_deleted,不物理删除
3. **业务关联**: 通过 business_type 和 business_id 关联业务对象
4. **下载统计**: 每次下载自动增加 download_count
