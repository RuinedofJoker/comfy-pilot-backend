# 用户模块 - 数据模型

> 本文档定义用户模块相关的数据表设计

## 数据表

### user - 用户表

**表说明**: 存储用户基本信息

**表结构**:

| 字段名             | 类型 | 长度 | 允许空 | 默认值              | 说明                                                   |
|-----------------|------|------|-----|------------------|------------------------------------------------------|
| id              | BIGINT | - | NO  | -                | 主键ID                                                 |
| user_code       | VARCHAR | 255 | NO  | -                | 用户编码（唯一，在创建用户时随机生成）                                  |
| email           | VARCHAR | 255 | NO  | -                | 邮箱地址（唯一）                                             |
| username        | VARCHAR | 50 | YES | NULL             | 用户名                                                  |
| password_hash   | VARCHAR | 255 | NO  | -                | 密码哈希值（BCrypt）                                        |
| avatar_url      | VARCHAR | 500 | YES | NULL             | 头像URL                                                |
| status          | VARCHAR | 20 | NO  | 'ACTIVE'         | 用户状态：ACTIVE-活跃, INACTIVE-未激活, LOCKED-锁定, DELETED-已删除 |
| last_login_time | TIMESTAMP | - | YES | NULL             | 最后登录时间                                               |
| last_login_ip   | VARCHAR | 50 | YES | NULL             | 最后登录IP                                               |
| create_time     | TIMESTAMP | - | NO  | CURRENT_TIMESTAMP | 创建时间                                                 |
| create_by       | BIGINT | - | YES | NULL             | 创建人ID                                                |
| update_time     | TIMESTAMP | - | NO  | CURRENT_TIMESTAMP | 更新时间                                                 |
| update_by       | BIGINT | - | YES | NULL             | 更新人ID                                                |
| is_deleted      | BOOLEAN | - | NO  | FALSE            | 逻辑删除标记                                               |

**索引设计**:

| 索引名                  | 索引类型 | 字段 | 说明       |
|----------------------|----------|------|----------|
| pk_user              | PRIMARY KEY | id | 主键索引     |
| uk_user_code         | UNIQUE | user_code | 用户编码唯一索引 |
| uk_user_email        | UNIQUE | email | 邮箱唯一索引   |
| idx_user_username    | INDEX | username | 用户名索引    |
| idx_user_status      | INDEX | status | 状态索引     |
| idx_user_create_time | INDEX | create_time | 创建时间索引   |

**建表SQL**:

```sql
CREATE TABLE "user" (
    id BIGSERIAL PRIMARY KEY,
    user_code VARCHAR(255) NOT NULL,
    email VARCHAR(255) NOT NULL,
    username VARCHAR(50),
    password_hash VARCHAR(255) NOT NULL,
    avatar_url VARCHAR(500),
    status VARCHAR(20) NOT NULL DEFAULT 'ACTIVE',
    last_login_time TIMESTAMP,
    last_login_ip VARCHAR(50),
    create_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    create_by BIGINT,
    update_time TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
    update_by BIGINT,
    is_deleted BOOLEAN NOT NULL DEFAULT FALSE,
    CONSTRAINT uk_user_code UNIQUE (user_code),
    CONSTRAINT uk_user_email UNIQUE (email)
);

-- 创建索引
CREATE INDEX idx_user_username ON "user"(username);
CREATE INDEX idx_user_status ON "user"(status);
CREATE INDEX idx_user_create_time ON "user"(create_time);

-- 添加注释
COMMENT ON TABLE "user" IS '用户表';
COMMENT ON COLUMN "user".id IS '主键ID';
COMMENT ON COLUMN "user".user_code IS '用户编码（唯一，在创建用户时随机生成）';
COMMENT ON COLUMN "user".email IS '邮箱地址（唯一）';
COMMENT ON COLUMN "user".username IS '用户名';
COMMENT ON COLUMN "user".password_hash IS '密码哈希值（BCrypt）';
COMMENT ON COLUMN "user".avatar_url IS '头像URL';
COMMENT ON COLUMN "user".status IS '用户状态：ACTIVE-活跃, INACTIVE-未激活, LOCKED-锁定, DELETED-已删除';
COMMENT ON COLUMN "user".last_login_time IS '最后登录时间';
COMMENT ON COLUMN "user".last_login_ip IS '最后登录IP';
COMMENT ON COLUMN "user".create_time IS '创建时间';
COMMENT ON COLUMN "user".create_by IS '创建人ID';
COMMENT ON COLUMN "user".update_time IS '更新时间';
COMMENT ON COLUMN "user".update_by IS '更新人ID';
COMMENT ON COLUMN "user".is_deleted IS '逻辑删除标记';
```

## 数据字典

### 用户状态枚举 (UserStatus)

| 枚举值 | 说明 |
|--------|------|
| ACTIVE | 活跃状态，可正常使用 |
| INACTIVE | 未激活状态，注册后未激活邮箱 |
| LOCKED | 锁定状态，因违规或安全原因被锁定 |
| DELETED | 已删除状态，用户主动注销账户 |
