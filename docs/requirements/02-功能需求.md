# 功能需求

## 1. 用户认证模块

### 1.1 用户登录
- 用户名/密码登录
- JWT Token 认证
- 角色识别(管理员/普通用户)
- 登录后根据角色跳转不同页面

### 1.2 用户管理
- 用户注册(管理员创建)
- 用户信息修改
- 密码修改
- 用户禁用/启用

## 2. ComfyUI 服务管理模块(管理员)

### 2.1 服务 CRUD
- 添加 ComfyUI 服务实例
  - 服务名称、URL、描述
- 编辑服务信息
- 删除服务(检查关联工作流)
- 查看服务列表

### 2.2 服务监控
- 实时服务状态检测(在线/离线)
- 连接测试功能
- 服务统计信息(工作流数、会话数)

## 3. 工作流管理模块

### 3.1 工作流 CRUD
- 创建工作流
  - 关联 ComfyUI 服务
  - 工作流名称、描述
- 编辑工作流内容
- 删除工作流(检查关联会话)
- 查看工作流列表

### 3.2 工作流列表功能
- 网格/列表视图切换
- 搜索工作流(按名称)
- 筛选功能
  - 全部工作流
  - 最近使用
  - 收藏的工作流
- 排序选项
  - 最近使用
  - 名称
  - 创建时间
  - 修改时间
- 收藏/取消收藏

### 3.3 工作流编辑器
- 嵌入 ComfyUI 原生界面(iframe)
- 工作流选择器(下拉菜单)
- 保存工作流(Ctrl+S)
- 导出工作流文件
- 未保存修改检测和提示
- 切换工作流时保存提醒

## 4. AI Agent 对话模块

### 4.1 会话管理
- 创建新会话(关联工作流)
- 查看会话列表(左侧边栏)
- 切换会话(加载历史消息)
- 会话信息显示
  - 会话状态(进行中/已完成)
  - 会话标题
  - 最后操作摘要
  - 时间戳

### 4.2 对话功能
- 悬浮对话框
  - 可拖动定位
  - 可调整大小
  - 最小化/还原
  - 关闭按钮
- 消息发送和接收
- 消息历史显示
- 自动滚动到最新消息

### 4.3 工作流编辑辅助
- AI 理解用户需求
- 自动编辑工作流
- 工作流锁定机制
  - Agent 编辑时自动锁定
  - 显示锁定遮罩和提示
  - 编辑完成后自动解锁
- 操作提示卡片显示

## 5. 版本管理模块

### 5.1 版本创建
- Agent 编辑后自动创建版本快照
- 手动保存创建版本
- 版本关联会话信息

### 5.2 版本查看
- 查看版本历史列表
- 版本详情(时间、操作摘要)
- 版本对比(后续版本)

### 5.3 版本回滚
- 回滚到指定版本
- 回滚确认机制

## 6. 个人信息模块

### 6.1 信息管理
- 查看个人信息
- 编辑个人信息
  - 显示名称
  - 邮箱地址
  - 头像上传
- 用户统计数据
  - 工作流总数
  - 活跃会话数
  - 使用天数

### 6.2 账号安全
- 修改密码
- 当前密码验证
- 新密码确认

## 7. 导航与交互

### 7.1 全局导航
- Logo 返回首页(检查未保存修改)
- 用户头像下拉菜单
  - 个人信息
  - 我的工作流
  - 账号设置
  - 退出登录

### 7.2 页面跳转
- 服务选择页 → 工作流编辑器
- 我的工作流页 → 工作流编辑器(自动进入对应服务)
- 工作流编辑器 → 返回服务选择页
